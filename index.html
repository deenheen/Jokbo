<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Med-Study OS Final Demo v4.0</title>
    <style>
        /* [ê¸°ë³¸ ìŠ¤íƒ€ì¼] */
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Pretendard', sans-serif; }
        body { background-color: #e9ecef; height: 100vh; display: flex; justify-content: center; align-items: center; overflow: hidden; }

        /* íƒœë¸”ë¦¿ í”„ë ˆì„ */
        .tablet-frame {
            width: 1400px; height: 900px; background: white; border-radius: 20px;
            box-shadow: 0 30px 80px rgba(0,0,0,0.2); border: 10px solid #222; display: flex; overflow: hidden;
        }

        /* --- ì™¼ìª½: PDF ë·°ì–´ --- */
        .left-panel {
            flex: 1.3; background-color: #525659; display: flex; flex-direction: column;
            border-right: 1px solid #ddd; position: relative;
        }
        .current-page-badge {
            position: absolute; top: 20px; left: 50%; transform: translateX(-50%);
            background: rgba(0,0,0,0.7); color: white; padding: 8px 16px; border-radius: 20px; font-size: 14px; z-index: 100; backdrop-filter: blur(4px);
        }
        .pdf-scroll-area {
            flex: 1; overflow-y: auto; padding: 30px; display: flex; flex-direction: column; align-items: center; gap: 40px; scroll-behavior: smooth;
        }
        .pdf-page {
            width: 100%; max-width: 700px; height: 900px; background: white;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3); position: relative; padding: 50px; transition: transform 0.3s;
        }
        .pdf-page.active-view { border: 4px solid #2196f3; transform: scale(1.02); }
        .page-num { position: absolute; bottom: 20px; right: 20px; color: #999; }
        .pdf-title { font-size: 24px; font-weight: bold; margin-bottom: 20px; color: #333; border-bottom: 2px solid #333; padding-bottom: 10px; }
        .pdf-text { font-size: 16px; line-height: 1.8; color: #444; text-align: justify; margin-bottom: 20px; }

        /* ë“œë˜ê·¸ëœ ë©”ëª¨ */
        .dropped-note {
            position: absolute; width: 220px; background-color: #fff9c4; border-left: 5px solid #fbc02d;
            padding: 10px; font-size: 12px; color: #333; box-shadow: 2px 4px 10px rgba(0,0,0,0.15);
            border-radius: 0 8px 8px 0; cursor: pointer; z-index: 100;
        }
        .dropped-note:hover { transform: scale(1.05); }

        /* --- ì˜¤ë¥¸ìª½: íŒ¨ë„ --- */
        .right-panel {
            flex: 0.7; display: flex; flex-direction: column; background: #f8f9fa; border-left: 1px solid #ddd; position: relative;
        }
        .tabs { display: flex; border-bottom: 1px solid #ddd; background: white; flex-shrink: 0; }
        .tab { flex: 1; padding: 15px 10px; text-align: center; cursor: pointer; font-weight: bold; color: #888; font-size: 14px; }
        .tab.active { color: #2196f3; border-bottom: 3px solid #2196f3; background: #f0f7ff; }
        
        /* íƒ­ ì»¨í…ì¸  ì˜ì—­ (ìŠ¤í¬ë¡¤ ê°€ëŠ¥) */
        .tab-content-container { flex: 1; overflow-y: auto; position: relative; }
        .tab-content { display: none; padding: 20px; padding-bottom: 80px; /* í”Œë ˆì´ì–´ ê³µê°„ í™•ë³´ */ }
        .tab-content.active { display: block; }

        /* [ì±„íŒ… ìŠ¤íƒ€ì¼] */
        .chat-container { display: flex; flex-direction: column; gap: 15px; }
        .msg-date { text-align: center; font-size: 12px; color: #aaa; margin: 20px 0; position: relative; }
        .msg-date::before, .msg-date::after { content:""; position: absolute; top: 50%; width: 30%; height: 1px; background: #ddd; }
        .msg-date::before { left: 0; } .msg-date::after { right: 0; }
        .bubble { max-width: 90%; padding: 12px 16px; border-radius: 12px; font-size: 14px; line-height: 1.5; transition: background 0.5s; }
        .user-msg { align-self: flex-end; background: #e9ecef; color: #333; border-bottom-right-radius: 2px; }
        .ai-msg { align-self: flex-start; background: #e3f2fd; color: #0d47a1; border-bottom-left-radius: 2px; cursor: grab; }

        /* [ì¡±ë³´ ìŠ¤íƒ€ì¼] */
        .jokbo-card { background: white; padding: 15px; border-radius: 8px; border: 1px solid #ddd; margin-bottom: 10px; display: none; }
        .jokbo-card.visible { display: block; animation: fadeIn 0.5s; }
        .badge { display: inline-block; padding: 3px 8px; background: #ffebee; color: #c62828; font-size: 11px; border-radius: 4px; font-weight: bold; margin-bottom: 5px;}

        /* [ìŠ¤í¬ë¦½íŠ¸ ìŠ¤íƒ€ì¼] (ì‹ ê·œ ì¶”ê°€) */
        .script-segment { background: white; padding: 15px; border-radius: 8px; border: 1px solid #eee; margin-bottom: 15px; transition: all 0.3s; }
        .script-header { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 12px; color: #666; }
        .speaker { font-weight: bold; color: #2196f3; }
        .timestamp { background: #eee; padding: 2px 6px; border-radius: 4px; }
        .script-text { font-size: 14px; line-height: 1.6; color: #333; }
        
        /* [ì˜¤ë””ì˜¤ í”Œë ˆì´ì–´ ë°”] (ì‹ ê·œ ì¶”ê°€ - ìŠ¤ì¼€ì¹˜ ë°˜ì˜) */
        .audio-player-bar {
            position: absolute; bottom: 0; left: 0; right: 0; height: 70px; background: white; border-top: 1px solid #ddd;
            display: flex; align-items: center; padding: 0 20px; gap: 15px; box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
            display: none; /* ê¸°ë³¸ ìˆ¨ê¹€, ìŠ¤í¬ë¦½íŠ¸ íƒ­ì—ì„œë§Œ í‘œì‹œ */
        }
        .audio-player-bar.visible { display: flex; }
        .play-btn { width: 40px; height: 40px; background: #2196f3; border-radius: 50%; display: flex; justify-content: center; align-items: center; color: white; font-size: 20px; cursor: pointer; flex-shrink: 0; }
        .timeline-container { flex: 1; display: flex; flex-direction: column; gap: 5px; }
        .timeline-bar { height: 6px; background: #eee; border-radius: 3px; position: relative; }
        .timeline-progress { position: absolute; left: 0; top: 0; height: 100%; width: 45%; background: #2196f3; border-radius: 3px; }
        .time-info { display: flex; justify-content: space-between; font-size: 11px; color: #888; }
        .speed-control { font-size: 14px; font-weight: bold; color: #2196f3; cursor: pointer; flex-shrink: 0; }

        /* ê°•ì¡° íš¨ê³¼ */
        .active-context-bg { background-color: #fff59d !important; border: 2px solid #fbc02d !important; box-shadow: 0 0 15px rgba(255, 241, 118, 0.5); }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    </style>
</head>
<body>

<div class="tablet-frame">
    <div class="left-panel">
        <div class="current-page-badge" id="pageBadge">Page 13 / 60</div>
        <div class="pdf-scroll-area" id="pdfArea" onscroll="detectPage()">
            <div class="pdf-page" id="p13" ondrop="drop(event)" ondragover="allowDrop(event)">
                <div class="page-num">13</div>
                <div class="pdf-title">Chapter 4. ë‹¹ë‡¨ë³‘ì„± ì¼€í†¤ì‚°ì¦ (DKA)</div>
                <p class="pdf-text"><strong>1. ì •ì˜ ë° ê°œìš”</strong><br>ì¸ìŠë¦° ê²°í•ìœ¼ë¡œ ì¸í•œ ê³ í˜ˆë‹¹, ëŒ€ì‚¬ì„± ì‚°ì¦, ì¼€í†¤ì¦ì„ íŠ¹ì§•ìœ¼ë¡œ í•˜ëŠ” ê¸‰ì„± ëŒ€ì‚¬ í•©ë³‘ì¦ì´ë‹¤.</p>
                <div class="dropped-note" style="top: 250px; left: 380px;" onclick="focusChat('chat-13-2')">ğŸ”— AI ë©”ëª¨: ì¼€í†¤ì²´ ìƒì„± ì›ë¦¬</div>
            </div>
            <div class="pdf-page" id="p14" ondrop="drop(event)" ondragover="allowDrop(event)">
                <div class="page-num">14</div>
                <div class="pdf-title">Chapter 4. DKAì˜ ì„ìƒ ì¦ìƒ</div>
                <p class="pdf-text"><strong>3. ì£¼ìš” ì¦ìƒ</strong><br>í˜¸í¡ ë³´ìƒê¸°ì „ìœ¼ë¡œ <strong>ì¿ ìŠ¤ë§ˆìš¸ í˜¸í¡(Kussmaul Breathing)</strong>ì´ ë‚˜íƒ€ë‚˜ë©°, í˜¸ê¸° ì‹œ ê³¼ì¼ ëƒ„ìƒˆê°€ ë‚œë‹¤.</p>
            </div>
            <div class="pdf-page" id="p15" ondrop="drop(event)" ondragover="allowDrop(event)">
                <div class="page-num">15</div>
                <div class="pdf-title">Chapter 4. DKAì˜ ì¹˜ë£Œ ì›ì¹™</div>
                <p class="pdf-text"><strong>4. ì¹˜ë£Œ (Treatment)</strong><br>ì‘ê¸‰ ì¹˜ë£Œì˜ í•µì‹¬ì€ ìˆ˜ì•¡ ìš”ë²•(Hydration)ì´ë‹¤. ì¸ìŠë¦° íˆ¬ì—¬ ì „ ì¹¼ë¥¨(K+) ë†ë„ í™•ì¸ì´ í•„ìˆ˜ì ì´ë‹¤.</p>
            </div>
        </div>
    </div>

    <div class="right-panel">
        <div class="tabs">
            <div class="tab active" onclick="showTab('tab-chat')">AI ì±„íŒ…</div>
            <div class="tab" onclick="showTab('tab-jokbo')">ê´€ë ¨ ì¡±ë³´</div>
            <div class="tab" onclick="showTab('tab-script')">ë…¹ìŒ ìŠ¤í¬ë¦½íŠ¸</div>
        </div>

        <div class="tab-content-container">
            <div id="tab-chat" class="tab-content active">
                <div class="chat-container">
                    <div class="msg-date">Page 13 ì§ˆë¬¸</div>
                    <div class="bubble user-msg">DKAê°€ ë­ì•¼?</div>
                    <div class="bubble ai-msg" id="chat-13-1" draggable="true" ondragstart="drag(event)">ì¸ìŠë¦° ë¶€ì¡±ìœ¼ë¡œ ì¼€í†¤ì‚°ì´ ìŒ“ì—¬ í˜ˆì•¡ì´ ì‚°ì„±í™”ë˜ëŠ” ì‘ê¸‰ ì§ˆí™˜ì…ë‹ˆë‹¤.</div>
                    <div class="bubble ai-msg" id="chat-13-2" draggable="true" ondragstart="drag(event)">ì§€ë°©ì´ ë¶„í•´ë˜ë©´ì„œ ì‚°ì„± ë¬¼ì§ˆì¸ 'ì¼€í†¤ì²´'ê°€ ë‚˜ì˜µë‹ˆë‹¤.</div>
                    <div class="msg-date">Page 14 ì§ˆë¬¸</div>
                    <div class="bubble user-msg">ì¿ ìŠ¤ë§ˆìš¸ í˜¸í¡?</div>
                    <div class="bubble ai-msg" id="chat-14-1" draggable="true" ondragstart="drag(event)">ì‚°ì„± í˜ˆì•¡ì„ ì¤‘í™”ì‹œí‚¤ë ¤ê³  ê¹Šê³  ë¹ ë¥´ê²Œ ì‰¬ëŠ” í˜¸í¡ì…ë‹ˆë‹¤.</div>
                    <div class="msg-date">Page 15 ì§ˆë¬¸</div>
                    <div class="bubble user-msg">ì¹˜ë£Œ ìš°ì„ ìˆœìœ„ëŠ”?</div>
                    <div class="bubble ai-msg" id="chat-15-1" draggable="true" ondragstart="drag(event)"><strong>ìˆ˜ì•¡(Hydration)ì´ 1ìˆœìœ„</strong>ì…ë‹ˆë‹¤. ì¹¼ë¥¨ í™•ì¸ ì „ ì¸ìŠë¦° íˆ¬ì—¬ëŠ” ìœ„í—˜í•©ë‹ˆë‹¤.</div>
                </div>
            </div>

            <div id="tab-jokbo" class="tab-content">
                <div style="color:#666; font-size:13px; margin-bottom:15px;">ê´€ë ¨ ê¸°ì¶œë¬¸ì œ</div>
                <div class="jokbo-card p13-item visible"><span class="badge">23ë…„</span> Q. DKAì˜ ë³‘íƒœìƒë¦¬ ì¤‘ ê°„ì—ì„œì˜ ì‘ìš©ì€?</div>
                <div class="jokbo-card p14-item"><span class="badge">22ë…„</span> Q. ê³¼ì¼ ëƒ„ìƒˆ, ê¹Šì€ í˜¸í¡ í™˜ìì˜ ì§„ë‹¨ì€?</div>
                <div class="jokbo-card p15-item"><span class="badge">24ë…„</span> Q. K+ 2.8ì¸ DKA í™˜ìì˜ ìš°ì„  ì²˜ì¹˜ëŠ”?</div>
            </div>

            <div id="tab-script" class="tab-content">
                 <div class="script-segment" id="script-13-1">
                    <div class="script-header"><span class="speaker">í™”ì 1 (êµìˆ˜ë‹˜)</span><span class="timestamp">09:30</span></div>
                    <div class="script-text">ì, DKA ì •ì˜ ì¤‘ìš”í•©ë‹ˆë‹¤. ì¸ìŠë¦°ì´ ì—†ì–´ì„œ ëª¸ì´ ì‚°ì„±ìœ¼ë¡œ ë³€í•˜ëŠ” ê±°ì˜ˆìš”. ì¼€í†¤ì²´ ë•Œë¬¸ì´ì£ .</div>
                </div>
                <div class="script-segment" id="script-14-1">
                    <div class="script-header"><span class="speaker">í™”ì 1 (êµìˆ˜ë‹˜)</span><span class="timestamp">09:45</span></div>
                    <div class="script-text">ì¦ìƒìœ¼ë¡œëŠ” ìˆ¨ì„ í—ë–¡ì´ëŠ” ì¿ ìŠ¤ë§ˆìš¸ í˜¸í¡ì´ íŠ¹ì§•ì ì…ë‹ˆë‹¤. ì…ì—ì„œ ì•„ì„¸í†¤ ëƒ„ìƒˆê°€ ë‚˜ìš”.</div>
                </div>
                <div class="script-segment" id="script-15-1">
                    <div class="script-header"><span class="speaker">í™”ì 1 (êµìˆ˜ë‹˜)</span><span class="timestamp">10:05</span></div>
                    <div class="script-text">ì¹˜ë£Œì—ì„œ ì œì¼ ì¤‘ìš”í•œ ê±´ ì¸ìŠë¦°ì´ ì•„ë‹ˆë¼ ìˆ˜ì•¡ì…ë‹ˆë‹¤. ì¡±ë³´ì— ìì£¼ ë‚˜ì™€ìš”. ì¹¼ë¥¨ ì²´í¬ ê¼­ í•˜ì„¸ìš”.</div>
                </div>
                 <div style="height: 200px;"></div> </div>
        </div>

        <div class="audio-player-bar" id="audioPlayer">
            <div class="play-btn">â–¶</div>
            <div class="timeline-container">
                <div class="timeline-bar"><div class="timeline-progress" id="audioProgress"></div></div>
                <div class="time-info"><span id="currentTime">09:45</span><span>15:30</span></div>
            </div>
            <div class="speed-control">1.2x</div>
        </div>

    </div>
</div>

<script>
    // [ê¸°ëŠ¥ 1: í˜ì´ì§€ ê°ì§€ ë° ì‹±í¬]
    function detectPage() {
        const scrollArea = document.getElementById('pdfArea');
        const pages = ['p13', 'p14', 'p15'];
        const viewCenter = scrollArea.scrollTop + (scrollArea.clientHeight / 2);

        pages.forEach(pageId => {
            const pageEl = document.getElementById(pageId);
            if (viewCenter >= pageEl.offsetTop && viewCenter <= pageEl.offsetTop + pageEl.clientHeight) {
                const pageNum = pageId.replace('p', '');
                document.getElementById('pageBadge').innerText = `Page ${pageNum} / 60`;
                document.querySelectorAll('.pdf-page').forEach(p => p.classList.remove('active-view'));
                pageEl.classList.add('active-view');
                syncRightPanel(pageNum);
            }
        });
    }

    // [ê¸°ëŠ¥ 2: ì˜¤ë¥¸ìª½ íŒ¨ë„ ë™ê¸°í™” (ì±„íŒ…, ì¡±ë³´, ìŠ¤í¬ë¦½íŠ¸)]
    function syncRightPanel(pageNum) {
        // ì¡±ë³´ í•„í„°ë§
        document.querySelectorAll('.jokbo-card').forEach(card => card.classList.remove('visible'));
        document.querySelectorAll(`.p${pageNum}-item`).forEach(card => card.classList.add('visible'));

        // ì‹±í¬ ë§µí•‘ ë°ì´í„°
        const syncMap = {
            '13': { chat: 'chat-13-1', script: 'script-13-1', time: '09:30', progress: '20%' },
            '14': { chat: 'chat-14-1', script: 'script-14-1', time: '09:45', progress: '45%' },
            '15': { chat: 'chat-15-1', script: 'script-15-1', time: '10:05', progress: '70%' }
        };

        const target = syncMap[pageNum];
        if (target) {
            // í˜„ì¬ í™œì„±í™”ëœ íƒ­ì— ë”°ë¼ ìŠ¤í¬ë¡¤ ë° í•˜ì´ë¼ì´íŠ¸
            const activeTabId = document.querySelector('.tab-content.active').id;
            let targetElId = activeTabId === 'tab-chat' ? target.chat : (activeTabId === 'tab-script' ? target.script : null);
            
            if (targetElId) {
                const targetEl = document.getElementById(targetElId);
                document.querySelector('.tab-content-container').scrollTo({ top: targetEl.offsetTop - 100, behavior: 'smooth' });
                highlightEffect(targetEl);
            }

            // ì˜¤ë””ì˜¤ í”Œë ˆì´ì–´ ìƒíƒœ ì—…ë°ì´íŠ¸ (ìŠ¤í¬ë¦½íŠ¸ ì‹±í¬)
            document.getElementById('currentTime').innerText = target.time;
            document.getElementById('audioProgress').style.width = target.progress;
        }
    }

    function highlightEffect(element) {
        document.querySelectorAll('.active-context-bg').forEach(el => el.classList.remove('active-context-bg'));
        element.classList.add('active-context-bg');
        setTimeout(() => { element.classList.remove('active-context-bg'); }, 2000);
    }

    // [ê¸°ëŠ¥ 3: íƒ­ ì „í™˜ ë° í”Œë ˆì´ì–´ í‘œì‹œ í† ê¸€]
    function showTab(tabId) {
        document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.tab').forEach(el => el.classList.remove('active'));
        document.getElementById(tabId).classList.add('active');
        
        const tabs = ['tab-chat', 'tab-jokbo', 'tab-script'];
        document.querySelectorAll('.tab')[tabs.indexOf(tabId)].classList.add('active');

        // ìŠ¤í¬ë¦½íŠ¸ íƒ­ì¼ ë•Œë§Œ ì˜¤ë””ì˜¤ í”Œë ˆì´ì–´ í‘œì‹œ
        const player = document.getElementById('audioPlayer');
        if (tabId === 'tab-script') player.classList.add('visible');
        else player.classList.remove('visible');
        
        // íƒ­ ì „í™˜ ì‹œ í˜„ì¬ í˜ì´ì§€ ê¸°ì¤€ ì¬ì‹±í¬
        detectPage();
    }

    // [ê¸°ëŠ¥ 4: ë“œë˜ê·¸ ì•¤ ë“œë¡­ & ì—­ë§í¬] (ê¸°ì¡´ ìœ ì§€)
    function drag(ev) { ev.dataTransfer.setData("chatId", ev.target.id); ev.dataTransfer.setData("text", ev.target.innerText); }
    function allowDrop(ev) { ev.preventDefault(); }
    function drop(ev) {
        ev.preventDefault();
        const chatId = ev.dataTransfer.getData("chatId"); const text = ev.dataTransfer.getData("text");
        const rect = ev.currentTarget.getBoundingClientRect();
        const note = document.createElement("div");
        note.className = "dropped-note"; note.innerHTML = `ğŸ“Œ <b>AI ë©”ëª¨</b><br>${text.substring(0, 20)}...`;
        note.style.left = (ev.clientX - rect.left) + "px"; note.style.top = (ev.clientY - rect.top) + "px";
        note.onclick = () => focusChat(chatId);
        ev.currentTarget.appendChild(note);
    }
    function focusChat(elementId) {
        showTab('tab-chat');
        const el = document.getElementById(elementId);
        if(el) {
            document.querySelector('.tab-content-container').scrollTo({ top: el.offsetTop - 100, behavior: 'smooth' });
            highlightEffect(el);
        }
    }

    detectPage(); // ì´ˆê¸° ì‹¤í–‰
</script>
</body>
</html>
