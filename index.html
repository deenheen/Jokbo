import React, { useState } from 'react';
import { MessageSquare, BookOpen, Save, Send, ChevronLeft, ChevronRight, Pin } from 'lucide-react';

const AIDemoAppV2 = () => {
  const [currentPage, setCurrentPage] = useState(1);
  const [activeTab, setActiveTab] = useState('jokbo');
  const [chatInput, setChatInput] = useState('');
  const [messages, setMessages] = useState([{ role: 'ai', content: 'ê°•ì˜ë¡ì˜ DNA ì‹¤í—˜ ë¶€ë¶„ì´ ì–´ë µë‹¤ë©´ ì§ˆë¬¸í•´ ì£¼ì„¸ìš”!' }]);
  
  // ğŸ“Œ ê°•ì˜ë¡ ìœ„ì— ë„ì›Œì§ˆ 'í•€' ì €ì¥ì†Œ
  const [pinnedNotes, setPinnedNotes] = useState([
    { id: 101, page: 3, type: 'jokbo', content: '14. Let the cell has 32 chromosomes...', x: '60%', y: '15%', color: 'bg-cyan-100 border-cyan-400' }
  ]);

  const lecturePages = [
    { id: 1, title: "ì„¸í¬ ë¶„ì—´ ê¸°ì´ˆ", content: "ëª¨ë“  ìƒëª…ì²´ëŠ” ì„¸í¬ ë¶„ì—´ì„ í†µí•´ ì„±ì¥í•©ë‹ˆë‹¤..." },
    { id: 2, title: "DNA ë³µì œ ê¸°ì „", content: "Sê¸°ì—ì„œ DNA ë³µì œê°€ ì¼ì–´ë‚˜ë©°, í—¬ë¦¬ì¼€ì´ìŠ¤ íš¨ì†Œê°€..." },
    { id: 3, title: "Evidence: Viral DNA", content: "Hersheyì™€ Chaseì˜ ì‹¤í—˜ì€ DNAê°€ ìœ ì „ ë¬¼ì§ˆì„ì„ ì¦ëª…í–ˆìŠµë‹ˆë‹¤. ë°•í…Œë¦¬ì˜¤íŒŒì§€(Phage)ë¥¼ ì´ìš©í•˜ì—¬..." }
  ];

  const examQuestions = [
    { id: 14, text: "14. Let the cell has 32 chromosomes. In mitosis, how many chromosomes...", pageRef: 3 },
    { id: 20, text: "20. Extracellular peripheral proteinì˜ ê¸°ì „ì€?", pageRef: 1 },
  ];

  // 1. ì¡±ë³´ë‚˜ ì±„íŒ… ë‹µë³€ì„ ê°•ì˜ë¡ì— í•€ìœ¼ë¡œ ê³ ì •í•˜ëŠ” í•¨ìˆ˜
  const pinToSlide = (content, type) => {
    const newPin = {
      id: Date.now(),
      page: currentPage,
      type: type,
      content: content.substring(0, 60) + "...", // ìš”ì•½ í‘œì‹œ
      x: `${Math.random() * 50 + 20}%`, // ëœë¤ ìœ„ì¹˜ (ì‹¤ì œë¡œëŠ” ë“œë˜ê·¸ ìœ„ì¹˜)
      y: `${Math.random() * 50 + 10}%`,
      color: type === 'chat' ? 'bg-orange-100 border-orange-400' : 'bg-green-100 border-green-400'
    };
    setPinnedNotes([...pinnedNotes, newPin]);
  };

  const handleSendMessage = () => {
    if (!chatInput.trim()) return;
    setMessages(prev => [...prev, { role: 'user', content: chatInput }]);
    setTimeout(() => {
      setMessages(prev => [...prev, { 
        role: 'ai', 
        content: `ë°•í…Œë¦¬ì˜¤íŒŒì§€ëŠ” DNAë¥¼ ì„¸í¬ ë‚´ë¡œ ì£¼ì…í•˜ì—¬ ë³µì œí•©ë‹ˆë‹¤.`,
        canPin: true 
      }]);
    }, 600);
    setChatInput('');
  };

  return (
    <div className="flex h-screen bg-gray-200">
      
      {/* ì™¼ìª½: ê°•ì˜ë¡ ë·°ì–´ (í•€ ì˜¤ë²„ë ˆì´ ì˜ì—­) */}
      <div className="w-3/5 relative flex flex-col border-r bg-white shadow-2xl m-2 rounded-xl overflow-hidden">
        <div className="p-3 bg-slate-700 text-white flex justify-between">
          <span className="font-bold">ğŸ“„ Lecture Viewer</span>
          <div className="flex gap-2">
            <button onClick={() => setCurrentPage(Math.max(1, currentPage-1))}><ChevronLeft size={18}/></button>
            <span>{currentPage} / 3</span>
            <button onClick={() => setCurrentPage(Math.min(3, currentPage+1))}><ChevronRight size={18}/></button>
          </div>
        </div>

        {/* ì‹¤ì œ ê°•ì˜ë¡ ë‚´ìš© & í•€ë“¤ì´ ëœ¨ëŠ” ê³³ */}
        <div className="flex-1 p-12 relative bg-[#f8f9fa] overflow-hidden">
          <h1 className="text-3xl font-serif font-bold text-blue-900 mb-8 underline decoration-blue-200">
            {lecturePages[currentPage-1].title}
          </h1>
          <p className="text-xl leading-relaxed text-gray-800 whitespace-pre-wrap">
            {lecturePages[currentPage-1].content}
            {"\n\n".repeat(5)} {/* ì´ë¯¸ì§€ì²˜ëŸ¼ ê³µê°„ í™•ë³´ */}
          </p>

          {/* ğŸ“ í˜„ì¬ í˜ì´ì§€ì— í•´ë‹¹í•˜ëŠ” í•€ë“¤ì„ í™”ë©´ì— ë Œë”ë§ */}
          {pinnedNotes.filter(n => n.page === currentPage).map(pin => (
            <div 
              key={pin.id}
              style={{ left: pin.x, top: pin.y }}
              className={`absolute p-3 rounded shadow-lg border-2 w-48 text-xs animate-in fade-in zoom-in duration-300 ${pin.color}`}
            >
              <div className="flex justify-between items-start mb-1">
                <span className="font-bold text-[10px] uppercase">{pin.type} Note</span>
                <button onClick={() => setPinnedNotes(pinnedNotes.filter(p => p.id !== pin.id))} className="text-gray-400 hover:text-red-500">Ã—</button>
              </div>
              {pin.content}
            </div>
          ))}
        </div>
      </div>

      {/* ì˜¤ë¥¸ìª½: ì‚¬ì´ë“œë°” (ì¡±ë³´/ì±„íŒ…) */}
      <div className="w-2/5 flex flex-col bg-white m-2 rounded-xl shadow-lg overflow-hidden">
        <div className="flex border-b bg-gray-50">
          <button onClick={() => setActiveTab('jokbo')} className={`flex-1 p-4 font-bold ${activeTab === 'jokbo' ? 'text-blue-600 border-b-2 border-blue-600' : 'text-gray-400'}`}>ì¡±ë³´ ë§¤ì¹­</button>
          <button onClick={() => setActiveTab('chat')} className={`flex-1 p-4 font-bold ${activeTab === 'chat' ? 'text-blue-600 border-b-2 border-blue-600' : 'text-gray-400'}`}>AI ì±„íŒ…</button>
        </div>

        <div className="flex-1 p-4 overflow-y-auto">
          {activeTab === 'jokbo' ? (
            <div className="space-y-3">
              {examQuestions.map(q => (
                <div key={q.id} className={`p-4 rounded border transition-all ${q.pageRef === currentPage ? 'bg-blue-50 border-blue-300' : 'opacity-40'}`}>
                  <p className="text-sm">{q.text}</p>
                  {q.pageRef === currentPage && (
                    <button 
                      onClick={() => pinToSlide(q.text, 'jokbo')}
                      className="mt-2 text-xs flex items-center gap-1 text-blue-500 font-bold hover:bg-blue-100 p-1 rounded"
                    >
                      <Pin size={12}/> ì´ ë‚´ìš©ì„ ê°•ì˜ë¡ì— ê³ ì •
                    </button>
                  )}
                </div>
              ))}
            </div>
          ) : (
            <div className="h-full flex flex-col">
              <div className="flex-1 space-y-4">
                {messages.map((m, i) => (
                  <div key={i} className={`flex ${m.role === 'user' ? 'justify-end' : 'justify-start'}`}>
                    <div className={`p-3 rounded-lg max-w-[85%] text-sm ${m.role === 'user' ? 'bg-blue-600 text-white' : 'bg-gray-100 border'}`}>
                      {m.content}
                      {m.canPin && (
                        <button 
                          onClick={() => pinToSlide(m.content, 'chat')}
                          className="mt-2 block text-[10px] text-orange-600 font-bold hover:underline"
                        >
                          ğŸ“Œ ì´ ë‹µë³€ì„ ê°•ì˜ë¡ì— í•€ìœ¼ë¡œ ê½‚ê¸°
                        </button>
                      )}
                    </div>
                  </div>
                ))}
              </div>
              <div className="mt-4 flex gap-2">
                <input value={chatInput} onChange={e => setChatInput(e.target.value)} placeholder="AIì—ê²Œ ì§ˆë¬¸..." className="flex-1 border p-2 rounded-lg text-sm" />
                <button onClick={handleSendMessage} className="bg-blue-600 text-white p-2 rounded-lg"><Send size={18}/></button>
              </div>
            </div>
          )}
        </div>
      </div>
    </div>
  );
};

export default AIDemoAppV2;
            background: #333; color: #fff;
            padding: 8px; border-radius: 5px;
            font-size: 12px; margin-top: 25px;
            z-index: 10; width: 200px;
        }

        /* [ì˜¤ë¥¸ìª½] ì‚¬ì´ë“œë°” */
        .sidebar {
            flex: 1;
            min-width: 350px;
            max-width: 450px;
            background: #fff;
            border-left: 1px solid var(--border);
            display: flex;
            flex-direction: column;
        }

        /* íƒ­ ë²„íŠ¼ */
        .tabs { display: flex; border-bottom: 1px solid #eee; }
        .tab-btn {
            flex: 1; padding: 15px; background: none; border: none;
            font-weight: bold; color: #888; cursor: pointer;
        }
        .tab-btn.active { color: var(--primary); border-bottom: 3px solid var(--primary); }

        /* íƒ­ ë‚´ìš© */
        .tab-content { flex: 1; padding: 20px; display: none; overflow-y: auto; }
        .tab-content.show { display: block; }
        .tab-content.flex-col { display: none; flex-direction: column; }
        .tab-content.flex-col.show { display: flex; }

        /* ì—…ë¡œë“œ ë°•ìŠ¤ */
        .upload-box {
            border: 2px dashed #ccc; border-radius: 10px; padding: 30px;
            text-align: center; cursor: pointer; margin-top: 20px;
            transition: 0.2s;
        }
        .upload-box:hover { border-color: var(--primary); background: #eef2ff; }

        /* ì¡±ë³´ ë¦¬ìŠ¤íŠ¸ */
        .match-card {
            background: #fff; border: 1px solid #eee;
            border-left: 5px solid #22c55e;
            padding: 15px; margin-bottom: 10px;
            border-radius: 5px; cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .tag { font-size: 11px; background: #eee; padding: 2px 6px; border-radius: 4px; color: #555; }

        /* ì±„íŒ…ì°½ */
        .chat-area { flex: 1; overflow-y: auto; padding: 10px; display: flex; flex-direction: column; gap: 10px; }
        .msg { padding: 10px 15px; border-radius: 15px; max-width: 85%; font-size: 14px; line-height: 1.4; }
        .msg.ai { background: #f3f4f6; align-self: flex-start; border-top-left-radius: 2px; }
        .msg.user { background: var(--primary); color: #fff; align-self: flex-end; border-top-right-radius: 2px; }
        
        .chat-input-box {
            border-top: 1px solid #eee; padding: 15px; display: flex; gap: 10px;
        }
        .chat-input { flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 20px; outline: none; }
        .send-btn { background: var(--primary); color: #fff; border: none; width: 40px; height: 40px; border-radius: 50%; cursor: pointer; }

        /* ì €ì¥ ë²„íŠ¼ */
        .save-btn {
            font-size: 11px; border: 1px solid #ddd; background: #fff;
            padding: 3px 8px; border-radius: 10px; margin-top: 5px; cursor: pointer;
        }

        /* ê¹œë¹¡ì„ ì• ë‹ˆë©”ì´ì…˜ */
        .flash { animation: flash 1.5s; }
        @keyframes flash { 0% { background: yellow; } 100% { background: transparent; } }

    </style>
</head>
<body>

    <div class="viewer-container">
        <div class="paper-doc">
            <h1>Evidence That Viral DNA Can Program Cells</h1>
            <p style="color:#666; font-size:14px; border-bottom:1px solid #eee; padding-bottom:10px;">Page 1 / Chapter 3</p>
            <br>
            <h3>1. Viral DNA Studies</h3>
            <p>
                More evidence for DNA as the genetic material came from studies of viruses that infect bacteria.
                Such viruses, called 
                <span class="highlight" id="word-1" data-tip="[Q14] Bacteriophagesì˜ ì •ì˜ë¥¼ ë¬»ëŠ” ê¸°ì¶œë¬¸ì œ (2023 ê¸°ë§)">bacteriophages (or phages)</span>, 
                are widely used in molecular genetics research.
            </p>
            <p>
                A virus is DNA (or RNA) enclosed by a protective protein coat. 
                Viruses must infect cells and take over the cells' metabolic machinery in order to reproduce.
            </p>
            <h3>2. Hershey-Chase Experiment</h3>
            <p>
                Alfred Hershey and Martha Chase showed that the genetic material of a phage known as T2 is DNA.
                They designed an experiment showing that only the 
                <span class="highlight" id="word-2" data-tip="[ì„œìˆ í˜•] DNAê°€ ìœ ì „ë¬¼ì§ˆì„ì„ ì¦ëª…í•œ ì‹¤í—˜ ê²°ê³¼ ì„œìˆ ">DNA of the T2 phage</span>, 
                and not the protein, enters an <em>E. coli</em> cell.
            </p>
        </div>
    </div>

    <div class="sidebar">
        <div class="tabs">
            <button class="tab-btn active" onclick="setTab('jokbo', this)">ì¡±ë³´ ë§¤ì¹­</button>
            <button class="tab-btn" onclick="setTab('ai', this)">AI íŠœí„°</button>
            <button class="tab-btn" onclick="setTab('saved', this)">ì €ì¥ë¨</button>
        </div>

        <div id="tab-jokbo" class="tab-content show">
            <div id="upload-area" class="upload-box" onclick="analyze()">
                <i class="fas fa-file-upload fa-2x"></i><br><br>
                <b>ì¡±ë³´ íŒŒì¼ ì—…ë¡œë“œ (Click)</b><br>
                <span style="font-size:12px; color:#999;">Demo ë²„ì „ì…ë‹ˆë‹¤.</span>
            </div>
            <div id="result-area" style="display:none;">
                <h4 style="margin-bottom:15px; color:#333;">ë¶„ì„ ê²°ê³¼: 2ê±´ ë§¤ì¹­</h4>
                <div class="match-card" onclick="jumpTo('word-1')">
                    <span class="tag">2023 ê¸°ë§ Q14</span>
                    <div style="font-weight:bold; margin-top:5px;">Bacteriophages ì •ì˜</div>
                </div>
                <div class="match-card" onclick="jumpTo('word-2')">
                    <span class="tag">2024 ì„œìˆ í˜•</span>
                    <div style="font-weight:bold; margin-top:5px;">Hershey-Chase ì‹¤í—˜</div>
                </div>
            </div>
        </div>

        <div id="tab-ai" class="tab-content flex-col">
            <div class="chat-area" id="chat-box">
                <div class="msg ai">
                    ì•ˆë…•í•˜ì„¸ìš”! ì¡±ë³´ì™€ ê°•ì˜ë¡ì„ ë¶„ì„í–ˆìŠµë‹ˆë‹¤.<br>
                    ê¶ê¸ˆí•œ ì ì„ ë¬¼ì–´ë³´ì„¸ìš”.
                </div>
            </div>
            <div class="chat-input-box">
                <input type="text" id="u-input" class="chat-input" placeholder="ì§ˆë¬¸ ì…ë ¥..." onkeypress="if(event.key=='Enter') send()">
                <button class="send-btn" onclick="send()"><i class="fas fa-paper-plane"></i></button>
            </div>
        </div>

        <div id="tab-saved" class="tab-content">
            <div id="saved-list" style="text-align:center; color:#999; margin-top:50px;">
                ì €ì¥ëœ ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.
            </div>
        </div>
    </div>

    <script>
        // --- ê¸°ëŠ¥ ìŠ¤í¬ë¦½íŠ¸ (Vanilla JS) ---

        // 1. íƒ­ ì „í™˜
        function setTab(id, btn) {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            document.querySelectorAll('.tab-content').forEach(c => {
                c.classList.remove('show');
                if(c.id === 'tab-ai') c.style.display = 'none';
            });
            
            const target = document.getElementById('tab-' + id);
            if(id === 'ai') target.style.display = 'flex';
            else target.classList.add('show');
        }

        // 2. ë¶„ì„ ì‹œë®¬ë ˆì´ì…˜
        function analyze() {
            const box = document.getElementById('upload-area');
            box.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ë¶„ì„ ì¤‘...';
            setTimeout(() => {
                box.style.display = 'none';
                document.getElementById('result-area').style.display = 'block';
                // í•˜ì´ë¼ì´íŠ¸ í™œì„±í™”
                document.querySelectorAll('.highlight').forEach(el => el.classList.add('active'));
            }, 1000);
        }

        // 3. ì´ë™ ë° ê°•ì¡°
        function jumpTo(id) {
            const el = document.getElementById(id);
            el.scrollIntoView({ behavior: 'smooth', block: 'center' });
            el.parentElement.classList.add('flash');
            setTimeout(() => el.parentElement.classList.remove('flash'), 1500);
        }

        // 4. ì±„íŒ…
        function send() {
            const input = document.getElementById('u-input');
            const txt = input.value.trim();
            if(!txt) return;

            addMsg('user', txt);
            input.value = '';

            setTimeout(() => {
                let reply = "ê°•ì˜ë¡ì— ì—†ëŠ” ë‚´ìš©ì…ë‹ˆë‹¤.";
                if(txt.includes('ì¡±ë³´') || txt.includes('ìš”ì•½')) reply = "í•µì‹¬ ì¡±ë³´ëŠ” <b>Hershey-Chase ì‹¤í—˜</b>ì…ë‹ˆë‹¤. DNAê°€ ìœ ì „ë¬¼ì§ˆì„ì„ ì¦ëª…í•˜ëŠ” ê³¼ì •ì„ ê¼­ ì™¸ìš°ì„¸ìš”!";
                else if(txt.includes('ì‹¤í—˜')) reply = "T2 íŒŒì§€ë¥¼ ì´ìš©í•´ ë‹¨ë°±ì§ˆì´ ì•„ë‹Œ DNAê°€ ì„¸í¬ë¡œ ë“¤ì–´ê°ì„ ì¦ëª…í–ˆìŠµë‹ˆë‹¤.";
                
                addMsg('ai', reply, true);
            }, 600);
        }

        function addMsg(type, html, saveBtn = false) {
            const box = document.getElementById('chat-box');
            let btn = '';
            if(saveBtn) {
                const plain = html.replace(/<[^>]*>?/gm, '');
                btn = `<br><button class="save-btn" onclick="save('${plain}')">ğŸ“Œ ì €ì¥</button>`;
            }
            box.innerHTML += `<div class="msg ${type}">${html}${btn}</div>`;
            box.scrollTop = box.scrollHeight;
        }

        // 5. ì €ì¥
        function save(txt) {
            const list = document.getElementById('saved-list');
            if(list.innerText.includes('ì—†ìŠµë‹ˆë‹¤')) list.innerHTML = '';
            list.innerHTML = `<div class="match-card"><b>${txt.substring(0,20)}...</b></div>` + list.innerHTML;
            alert('ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
        }
    </script>
</body>
</html>
        /* í™œì„±í™” ì‹œ ìŠ¤íƒ€ì¼ */
        .highlight-text.active {
            background-color: var(--highlight-bg);
            border-bottom: 2px solid var(--highlight-border);
            font-weight: 700;
        }

        /* íˆ´íŒ (ë§ˆìš°ìŠ¤ ì˜¬ë¦¬ë©´ ë¬¸ì œ ë³´ì´ê¸°) */
        .highlight-text:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%; left: 50%; transform: translateX(-50%);
            background: #1f2937; color: white;
            padding: 8px 12px; border-radius: 6px;
            font-size: 13px; width: 280px;
            z-index: 100; pointer-events: none; margin-bottom: 6px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        /* --- 3. ì˜¤ë¥¸ìª½: ì‚¬ì´ë“œë°” ì˜ì—­ (Sidebar) --- */
        .sidebar-container {
            width: 400px; /* ê³ ì • ë„ˆë¹„ */
            background: white;
            border-left: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            box-shadow: -2px 0 10px rgba(0,0,0,0.03);
            z-index: 10;
        }

        /* íƒ­ ë©”ë‰´ */
        .tabs { display: flex; border-bottom: 1px solid var(--border-color); background: #fff; }
        .tab-btn {
            flex: 1; padding: 16px; border: none; background: none;
            font-weight: 600; color: #6b7280; cursor: pointer; transition: 0.2s;
            border-bottom: 3px solid transparent;
        }
        .tab-btn:hover { background: #f9fafb; }
        .tab-btn.active { color: var(--primary); border-bottom-color: var(--primary); }

        /* íƒ­ ë‚´ìš©ë¬¼ */
        .tab-content {
            flex: 1; padding: 20px; overflow-y: auto; display: none; /* ê¸°ë³¸ ìˆ¨ê¹€ */
        }
        .tab-content.show { display: block; }
        /* ì±„íŒ… íƒ­ì€ Flex ë ˆì´ì•„ì›ƒ í•„ìš” */
        .tab-content.flex-layout { display: none; flex-direction: column; }
        .tab-content.flex-layout.show { display: flex; }

        /* ì¡±ë³´ ì—…ë¡œë“œ ë°•ìŠ¤ */
        .upload-area {
            border: 2px dashed #cbd5e1; border-radius: 12px;
            padding: 40px 20px; text-align: center;
            cursor: pointer; transition: 0.2s; margin-top: 20px;
        }
        .upload-area:hover { border-color: var(--primary); background: #eff6ff; }

        /* ì¡±ë³´ ë¦¬ìŠ¤íŠ¸ ì•„ì´í…œ */
        .match-card {
            background: #fff; border: 1px solid var(--border-color);
            border-left: 5px solid #22c55e; /* ì´ˆë¡ìƒ‰ í¬ì¸íŠ¸ */
            padding: 16px; border-radius: 8px; margin-bottom: 12px;
            cursor: pointer; transition: transform 0.2s;
        }
        .match-card:hover { transform: translateY(-3px); box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
        .match-tag {
            font-size: 11px; background: #e0f2fe; color: #0369a1;
            padding: 3px 8px; border-radius: 99px; font-weight: bold;
            display: inline-block; margin-bottom: 6px;
        }

        /* ì±„íŒ… ìŠ¤íƒ€ì¼ */
        .chat-box { flex: 1; overflow-y: auto; padding: 10px; display: flex; flex-direction: column; gap: 15px; }
        .msg { padding: 12px 16px; border-radius: 16px; max-width: 85%; font-size: 14px; line-height: 1.5; }
        .msg.ai { background: #f3f4f6; color: #1f2937; align-self: flex-start; border-top-left-radius: 4px; }
        .msg.user { background: var(--primary); color: white; align-self: flex-end; border-top-right-radius: 4px; }
        
        .chat-input-area {
            border-top: 1px solid var(--border-color); padding: 15px;
            display: flex; gap: 8px; background: white;
        }
        .chat-input {
            flex: 1; padding: 12px; border: 1px solid #d1d5db;
            border-radius: 24px; outline: none;
        }
        .send-btn {
            width: 44px; height: 44px; background: var(--primary); color: white;
            border: none; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center;
        }

        /* ì €ì¥ ë²„íŠ¼ */
        .save-note-btn {
            display: inline-block; margin-top: 8px; font-size: 11px;
            padding: 4px 10px; background: white; border: 1px solid #d1d5db;
            border-radius: 12px; cursor: pointer; color: #374151;
        }
        .save-note-btn:hover { background: #f9fafb; border-color: var(--primary); color: var(--primary); }

        /* ê¹œë¹¡ì„ ì• ë‹ˆë©”ì´ì…˜ (ì´ë™ ì‹œ) */
        .flash-anim { animation: flash 1.5s ease; }
        @keyframes flash {
            0% { background-color: rgba(255, 255, 0, 0.4); }
            100% { background-color: transparent; }
        }
    </style>
</head>
<body>

    <main class="viewer-container">
        <div class="paper-doc">
            <h1>Evidence That Viral DNA Can Program Cells</h1>
            <p style="color:#666; font-size: 14px; border-bottom:1px solid #eee; padding-bottom:10px;">
                Page 1 / Chapter 3: Molecular Genetics
            </p>

            <br>
            <h3>1. Introduction to Viral DNA</h3>
            <p>
                More evidence for DNA as the genetic material came from studies of viruses that infect bacteria.
                Such viruses, called 
                <span class="highlight-text" id="loc-1" data-tooltip="[Q14] Bacteriophagesì˜ ì •ì˜ì™€ ë¶„ììœ ì „í•™ì—ì„œì˜ ì—­í• ì€?">bacteriophages (or phages)</span>, 
                are widely used in molecular genetics research.
            </p>

            <p>
                A virus is DNA (or RNA) enclosed by a protective protein coat. 
                Viruses must infect cells and take over the cells' metabolic machinery in order to reproduce.
            </p>

            <h3>2. The Hershey-Chase Experiment</h3>
            <p>
                Alfred Hershey and Martha Chase showed that the genetic material of a phage known as T2 is DNA.
                They designed an experiment showing that only the 
                <span class="highlight-text" id="loc-2" data-tooltip="[ì„œìˆ í˜•] Hershey-Chase ì‹¤í—˜ì—ì„œ ë‹¨ë°±ì§ˆì´ ì•„ë‹Œ DNAê°€ ìœ ì „ë¬¼ì§ˆì„ì„ ì¦ëª…í•œ ê·¼ê±°ëŠ”?">DNA of the T2 phage</span>, 
                and not the protein, enters an <em>E. coli</em> cell during infection.
            </p>

            <p id="loc-3">
                This experiment concluded that the injected DNA of the phage provides the genetic information.
            </p>
        </div>
    </main>

    <aside class="sidebar-container">
        <nav class="tabs">
            <button class="tab-btn active" onclick="changeTab('jokbo', this)">
                <i class="fas fa-list-check"></i> ì¡±ë³´ ë§¤ì¹­
            </button>
            <button class="tab-btn" onclick="changeTab('ai', this)">
                <i class="fas fa-robot"></i> AI íŠœí„°
            </button>
            <button class="tab-btn" onclick="changeTab('saved', this)">
                <i class="fas fa-bookmark"></i> ì €ì¥ë¨
            </button>
        </nav>

        <div id="tab-jokbo" class="tab-content show">
            <div id="upload-panel" class="upload-area" onclick="startAnalysis()">
                <i class="fas fa-file-upload fa-3x" style="color:#94a3b8; margin-bottom:15px;"></i><br>
                <b>ì¡±ë³´ íŒŒì¼ ì—…ë¡œë“œ (Demo)</b><br>
                <span style="font-size:12px; color:#64748b;">í´ë¦­í•˜ë©´ ë¶„ì„ì„ ì‹œì‘í•©ë‹ˆë‹¤.</span>
            </div>

            <div id="result-panel" style="display: none;">
                <h4 style="margin: 10px 0 20px 0; color:#333;">
                    <i class="fas fa-check-circle" style="color:#22c55e;"></i> ë¶„ì„ ê²°ê³¼: 2ê±´ ë§¤ì¹­
                </h4>

                <div class="match-card" onclick="moveToLoc('loc-1')">
                    <span class="match-tag">2023 ê¸°ë§ê³ ì‚¬ Q14</span>
                    <div style="font-weight:bold; font-size:15px; margin-bottom:5px;">Bacteriophages ì •ì˜</div>
                    <div style="font-size:12px; color:#666;">ê°•ì˜ë¡ ìƒë‹¨ ì •ì˜ ë¶€ë¶„ê³¼ ì—°ê´€ë¨</div>
                </div>

                <div class="match-card" onclick="moveToLoc('loc-2')">
                    <span class="match-tag">2024 ì¤‘ê°„ê³ ì‚¬ ì„œìˆ í˜•</span>
                    <div style="font-weight:bold; font-size:15px; margin-bottom:5px;">Hershey-Chase ì‹¤í—˜</div>
                    <div style="font-size:12px; color:#666;">DNA ìœ ì „ë¬¼ì§ˆ ì¦ëª… ì‹¤í—˜ ë‚´ìš©</div>
                </div>
            </div>
        </div>

        <div id="tab-ai" class="tab-content flex-layout">
            <div class="chat-box" id="chat-container">
                <div class="msg ai">
                    ì•ˆë…•í•˜ì„¸ìš”! ì¡±ë³´ì™€ ê°•ì˜ë¡ì„ ë¶„ì„í–ˆìŠµë‹ˆë‹¤. <br>
                    <b>"ì´ í˜ì´ì§€ ì¡±ë³´ ì¤‘ìš” ë‚´ìš© ìš”ì•½í•´ì¤˜"</b>ë¼ê³  ë¬¼ì–´ë³´ì„¸ìš”.
                </div>
            </div>
            <div class="chat-input-area">
                <input type="text" id="user-input" class="chat-input" placeholder="ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”..." onkeypress="if(event.key==='Enter') sendMessage()">
                <button class="send-btn" onclick="sendMessage()"><i class="fas fa-paper-plane"></i></button>
            </div>
        </div>

        <div id="tab-saved" class="tab-content">
            <div id="saved-list">
                <div style="text-align:center; color:#999; margin-top:50px;">
                    <i class="far fa-folder-open fa-3x" style="opacity:0.3"></i><br><br>
                    ì €ì¥ëœ ë…¸íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.<br>
                    ì±„íŒ…ì°½ì—ì„œ 'ì €ì¥' ë²„íŠ¼ì„ ëˆŒëŸ¬ë³´ì„¸ìš”.
                </div>
            </div>
        </div>
    </aside>

    <script>
        // --- ê¸°ëŠ¥ êµ¬í˜„ (Vanilla JS) ---

        // 1. íƒ­ ì „í™˜ ê¸°ëŠ¥
        function changeTab(targetId, btnEl) {
            // ë²„íŠ¼ í™œì„±í™” ìŠ¤íƒ€ì¼ ë³€ê²½
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            btnEl.classList.add('active');

            // ë‚´ìš© ë³´ì´ê¸°/ìˆ¨ê¸°ê¸°
            document.querySelectorAll('.tab-content').forEach(c => {
                c.classList.remove('show');
                if(c.id === 'tab-ai') c.style.display = 'none'; // flex íƒ­ ì´ˆê¸°í™”
            });

            const target = document.getElementById('tab-' + targetId);
            if (targetId === 'ai') {
                target.style.display = 'flex'; // AI íƒ­ì€ flexë¡œ í‘œì‹œ
            } else {
                target.classList.add('show');
            }
        }

        // 2. ì¡±ë³´ ë¶„ì„ ì‹œë®¬ë ˆì´ì…˜
        function startAnalysis() {
            const uploadPanel = document.getElementById('upload-panel');
            uploadPanel.innerHTML = '<i class="fas fa-spinner fa-spin fa-2x"></i><br><br>ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤...';
            
            setTimeout(() => {
                uploadPanel.style.display = 'none';
                document.getElementById('result-panel').style.display = 'block';
                
                // ì™¼ìª½ ê°•ì˜ë¡ì— í˜•ê´‘íœ ì¹ í•˜ê¸°
                document.querySelectorAll('.highlight-text').forEach(el => {
                    el.classList.add('active');
                });

                alert("ë¶„ì„ ì™„ë£Œ! ê°•ì˜ë¡ì— ë…¸ë€ìƒ‰ í˜•ê´‘íœì´ í‘œì‹œë˜ì—ˆìŠµë‹ˆë‹¤.");
            }, 1200);
        }

        // 3. í•´ë‹¹ ìœ„ì¹˜ë¡œ ìŠ¤í¬ë¡¤ ì´ë™ (Deep Linking)
        function moveToLoc(id) {
            const el = document.getElementById(id);
            if(el) {
                el.scrollIntoView({ behavior: 'smooth', block: 'center' });
                // ê¹œë¹¡ì„ íš¨ê³¼
                el.closest('p').classList.add('flash-anim');
                setTimeout(() => el.closest('p').classList.remove('flash-anim'), 1600);
            }
        }

        // 4. ì±„íŒ… ê¸°ëŠ¥
        function sendMessage() {
            const input = document.getElementById('user-input');
            const text = input.value.trim();
            if(!text) return;

            // ì‚¬ìš©ì ë©”ì‹œì§€ ì¶”ê°€
            addMsg('user', text);
            input.value = '';

            // AI ë‹µë³€ ì‹œë®¬ë ˆì´ì…˜
            setTimeout(() => {
                let reply = "ì£„ì†¡í•´ìš”, ê·¸ ë‚´ìš©ì€ ê°•ì˜ë¡ì— ì—†ìŠµë‹ˆë‹¤.";
                if(text.includes('ì¡±ë³´') || text.includes('ìš”ì•½')) {
                    reply = "ì´ í˜ì´ì§€ì˜ í•µì‹¬ ì¡±ë³´ëŠ” <b>Bacteriophagesì˜ ì—­í• </b>ê³¼ <b>Hershey-Chase ì‹¤í—˜ ê²°ê³¼</b>ì…ë‹ˆë‹¤. íŠ¹íˆ ì„œìˆ í˜• ë¬¸ì œë¡œ ìì£¼ ì¶œì œë˜ë‹ˆ ì‹¤í—˜ ê³¼ì •ì„ ê¼­ ì•”ê¸°í•˜ì„¸ìš”!";
                } else if(text.includes('ì‹¤í—˜') || text.includes('DNA')) {
                    reply = "Hershey-Chase ì‹¤í—˜ì€ ë°©ì‚¬ì„± ë™ìœ„ì›ì†Œë¥¼ ì´ìš©í•˜ì—¬ ë‹¨ë°±ì§ˆì´ ì•„ë‹Œ DNAê°€ ì„¸í¬ ë‚´ë¡œ ë“¤ì–´ê°ì„ ì¦ëª…í–ˆìŠµë‹ˆë‹¤.";
                }
                
                addMsg('ai', reply, true);
            }, 700);
        }

        function addMsg(type, html, showSave = false) {
            const container = document.getElementById('chat-container');
            const div = document.createElement('div');
            div.className = `msg ${type}`;
            
            let btnHtml = '';
            if(showSave) {
                // ì €ì¥ ë²„íŠ¼ìš© í…ìŠ¤íŠ¸ ì¶”ì¶œ (HTML íƒœê·¸ ì œê±°)
                const plainText = html.replace(/<[^>]*>?/gm, '');
                btnHtml = `<br><button class="save-note-btn" onclick="saveNote('${plainText.substring(0,15)}...')">ğŸ“Œ ë…¸íŠ¸ì— ì €ì¥</button>`;
            }

            div.innerHTML = html + btnHtml;
            container.appendChild(div);
            container.scrollTop = container.scrollHeight;
        }

        // 5. ë…¸íŠ¸ ì €ì¥ ê¸°ëŠ¥
        function saveNote(text) {
            const list = document.getElementById('saved-list');
            if(list.innerText.includes('ì €ì¥ëœ ë…¸íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤')) {
                list.innerHTML = '';
            }
            
            const item = document.createElement('div');
            item.className = 'match-card'; // ê¸°ì¡´ ì¹´ë“œ ìŠ¤íƒ€ì¼ ì¬ì‚¬ìš©
            item.innerHTML = `
                <div style="font-weight:bold; font-size:14px;">${text}</div>
                <div style="font-size:11px; color:#888; margin-top:5px;">AI ì±„íŒ…ì—ì„œ ì €ì¥ë¨</div>
            `;
            
            list.prepend(item);
            
            // ì €ì¥ ì•Œë¦¼ ì‹œê°íš¨ê³¼ (íƒ­ ë²„íŠ¼ ê¹œë¹¡ì„ ë“±)
            const saveTabBtn = document.querySelectorAll('.tab-btn')[2];
            saveTabBtn.style.color = '#e11d48';
            setTimeout(() => saveTabBtn.style.color = '', 500);
        }
    </script>
</body>
</html>
