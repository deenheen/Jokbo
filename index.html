<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Med-Study OS v8.1 (Annotation Added)</title>
    <style>
        /* [ê¸°ë³¸ ìŠ¤íƒ€ì¼ & í°íŠ¸] */
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');
        @import url('https://fonts.googleapis.com/css2?family=Nanum+Pen+Script&display=swap'); /* ë‚˜ëˆ”íœìŠ¤í¬ë¦½íŠ¸ ì›¹í°íŠ¸ ì¶”ê°€ */
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Pretendard', sans-serif; }
        body { background-color: #f0f2f5; height: 100vh; display: flex; justify-content: center; align-items: center; overflow: hidden; }

        /* [ë©”ì¸ í”„ë ˆì„] */
        .tablet-frame {
            width: 1600px; height: 950px; background: white; border-radius: 12px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.15); border: 1px solid #ddd; display: flex; overflow: hidden;
        }

        /* --- [ì™¼ìª½: PDF ë·°ì–´ (Full Density)] --- */
        .left-panel {
            flex: 1.6; background-color: #3e3e3e; display: flex; flex-direction: column;
            border-right: 1px solid #333; position: relative;
        }
        
        .pdf-header {
            height: 48px; background: #2b2b2b; color: #e0e0e0; display: flex; align-items: center;
            padding: 0 20px; justify-content: space-between; font-size: 13px; font-weight: 500; border-bottom: 1px solid #1a1a1a; z-index: 10;
        }
        
        /* íœ ë„êµ¬ ì¶”ê°€ */
        .pen-tools { display: flex; gap: 10px; align-items: center; }
        .color-btn { width: 20px; height: 20px; border-radius: 50%; cursor: pointer; border: 2px solid transparent; transition: 0.2s; }
        .color-btn.active { border-color: white; transform: scale(1.2); box-shadow: 0 0 5px rgba(255,255,255,0.5); }

        .pdf-viewer-container {
            flex: 1; position: relative; overflow: hidden; background: #525659;
            display: flex; justify-content: center; align-items: center; padding: 20px;
        }

        /* ì‹¤ì œ PPT ìŠ¬ë¼ì´ë“œ ëŠë‚Œ */
        .pdf-page {
            width: 100%; height: 100%; max-width: 800px; max-height: 1130px; /* A4 ë¹„ìœ¨ */
            background: white; box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            padding: 40px 50px; position: absolute; display: none; flex-direction: column;
            border-radius: 2px;
            /* ì¤‘ìš”: ìº”ë²„ìŠ¤ ìœ„ì¹˜ ê¸°ì¤€ì  */
            position: relative; 
        }
        .pdf-page.active { display: flex; animation: fadeIn 0.2s ease-out; }

        /* --- [ì¶”ê°€ëœ ìŠ¤íƒ€ì¼: í•„ê¸°ìš© ìº”ë²„ìŠ¤] --- */
        .drawing-layer {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: 10; /* í…ìŠ¤íŠ¸ë³´ë‹¤ ìœ„ì— ìœ„ì¹˜ */
            cursor: crosshair; /* í•„ê¸° ëª¨ë“œ ì»¤ì„œ */
            touch-action: none; /* í„°ì¹˜ ìŠ¤í¬ë¡¤ ë°©ì§€ */
        }

        @keyframes fadeIn { from { opacity: 0; transform: scale(0.98); } to { opacity: 1; transform: scale(1); } }

        /* PDF ë‚´ë¶€ ë””ìì¸ (ì „ê³µì„œì  ìŠ¤íƒ€ì¼) */
        .slide-content-wrapper { position: relative; z-index: 1; /* í…ìŠ¤íŠ¸ ë‚´ìš© */ }
        .slide-header { border-bottom: 2px solid #003c8f; padding-bottom: 10px; margin-bottom: 25px; display: flex; justify-content: space-between; align-items: flex-end; }
        .slide-title { font-size: 24px; font-weight: 800; color: #003c8f; }
        .slide-sub { font-size: 14px; color: #666; font-weight: 600; }
        
        .content-block { margin-bottom: 25px; }
        .section-title { font-size: 16px; font-weight: 700; color: #333; margin-bottom: 8px; display: flex; align-items: center; }
        .section-title::before { content: ""; display: inline-block; width: 4px; height: 16px; background: #1565c0; margin-right: 8px; }
        
        .text-body { font-size: 14px; line-height: 1.7; color: #444; text-align: justify; letter-spacing: -0.3px; }
        .text-body strong { color: #000; font-weight: 700; }
        .text-body ul { padding-left: 20px; margin-top: 5px; }
        .text-body li { margin-bottom: 4px; }

        /* ë„í‘œ ë° ë°•ìŠ¤ ìŠ¤íƒ€ì¼ */
        .info-box { background: #f5f9ff; border: 1px solid #b3e5fc; padding: 12px; border-radius: 6px; font-size: 13px; margin: 10px 0; color: #0277bd; }
        .warn-box { background: #fff5f5; border: 1px solid #ffcdd2; padding: 12px; border-radius: 6px; font-size: 13px; margin: 10px 0; color: #c62828; font-weight: 600; }
        .lab-table { width: 100%; border-collapse: collapse; font-size: 12px; margin: 10px 0; }
        .lab-table th { background: #eee; padding: 6px; border: 1px solid #ccc; text-align: center; }
        .lab-table td { padding: 6px; border: 1px solid #ccc; text-align: center; }

        /* ë„¤ë¹„ê²Œì´ì…˜ ë²„íŠ¼ */
        .nav-btn {
            position: absolute; top: 50%; transform: translateY(-50%);
            width: 44px; height: 44px; background: rgba(0,0,0,0.6); color: white;
            border-radius: 50%; display: flex; justify-content: center; align-items: center;
            cursor: pointer; font-size: 20px; z-index: 100; transition: 0.2s;
        }
        .nav-btn:hover { background: rgba(0,0,0,0.8); }
        .nav-prev { left: 20px; } .nav-next { right: 20px; }
        .nav-btn.disabled { opacity: 0; pointer-events: none; }

        /* ë“œë˜ê·¸ëœ ë©”ëª¨ (í¬ìŠ¤íŠ¸ì‡) */
        .dropped-note {
            position: absolute; width: 220px; background-color: #fff9c4; border-left: 4px solid #fbc02d;
            padding: 10px; font-size: 12px; color: #333; box-shadow: 2px 4px 10px rgba(0,0,0,0.2);
            border-radius: 0 6px 6px 0; cursor: pointer; z-index: 50; line-height: 1.4;
            font-family: 'Nanum Pen Script', sans-serif; /* ì†ê¸€ì”¨ ëŠë‚Œ */
        }
        .dropped-note:hover { transform: scale(1.05); z-index: 60; }
        .dropped-note strong { color: #e65100; }

        /* --- [ì˜¤ë¥¸ìª½: ê¸°ëŠ¥ íŒ¨ë„] --- */
        .right-panel {
            flex: 0.8; display: flex; flex-direction: column; background: #f7f8fa; border-left: 1px solid #ddd; position: relative;
        }
        
        /* íƒ­ ë©”ë‰´ */
        .tabs { display: flex; background: white; border-bottom: 1px solid #ddd; flex-shrink: 0; height: 50px; }
        .tab { flex: 1; display: flex; align-items: center; justify-content: center; cursor: pointer; font-weight: 600; color: #888; font-size: 14px; transition: 0.2s; }
        .tab:hover { background: #f9f9f9; }
        .tab.active { color: #2196f3; border-bottom: 3px solid #2196f3; background: #fff; }

        .tab-content-container { flex: 1; overflow-y: auto; position: relative; scroll-behavior: smooth; }
        .tab-content { display: none; padding: 20px; padding-bottom: 100px; }
        .tab-content.active { display: block; }

        /* 1. AI ì±„íŒ… (Real Chat) */
        .chat-container { display: flex; flex-direction: column; gap: 16px; }
        .msg-group { display: flex; flex-direction: column; gap: 6px; }
        .msg-meta { font-size: 11px; color: #999; margin-left: 4px; display: flex; gap: 6px; }
        
        .bubble { max-width: 92%; padding: 12px 16px; border-radius: 12px; font-size: 13.5px; line-height: 1.55; box-shadow: 0 1px 2px rgba(0,0,0,0.05); }
        .user-msg { align-self: flex-end; background: #4a90e2; color: white; border-bottom-right-radius: 2px; }
        .ai-msg { align-self: flex-start; background: white; color: #333; border: 1px solid #eee; border-bottom-left-radius: 2px; cursor: grab; }
        .ai-msg:hover { border-color: #2196f3; box-shadow: 0 2px 8px rgba(33, 150, 243, 0.15); }
        .ai-msg ul { padding-left: 18px; margin-top: 5px; }

        /* 2. ì¡±ë³´ (KMLE Style) */
        .jokbo-card { background: white; padding: 20px; border-radius: 8px; border: 1px solid #e0e0e0; margin-bottom: 15px; display: none; box-shadow: 0 2px 5px rgba(0,0,0,0.02); }
        .jokbo-card.visible { display: block; animation: fadeIn 0.3s; }
        .badge-row { margin-bottom: 10px; }
        .badge { display: inline-block; padding: 3px 8px; font-size: 11px; border-radius: 4px; font-weight: 700; margin-right: 6px; }
        .badge.year { background: #e3f2fd; color: #1565c0; }
        .badge.tag { background: #f3e5f5; color: #7b1fa2; }
        .badge.freq { background: #ffebee; color: #c62828; }
        
        .q-body { font-size: 14px; font-weight: 600; color: #222; margin-bottom: 12px; line-height: 1.5; }
        .q-lab { font-size: 12px; color: #555; background: #f9f9f9; padding: 10px; border-radius: 6px; margin-bottom: 10px; font-family: monospace; border: 1px solid #eee; }
        .q-options { font-size: 13px; color: #444; display: flex; flex-direction: column; gap: 4px; }
        .q-options div { cursor: pointer; padding: 4px 8px; border-radius: 4px; }
        .q-options div:hover { background: #f0f0f0; }

        /* 3. ìŠ¤í¬ë¦½íŠ¸ (Transcript) */
        .script-segment { background: white; padding: 16px; border-radius: 8px; border: 1px solid #eee; margin-bottom: 12px; transition: all 0.3s; }
        .script-segment:hover { border-color: #b3e5fc; background: #fbfdff; }
        .script-header { display: flex; justify-content: space-between; margin-bottom: 6px; font-size: 11px; color: #888; }
        .speaker-name { font-weight: 700; color: #1976d2; }
        .script-text { font-size: 14px; line-height: 1.6; color: #333; }
        .highlight-text { background: linear-gradient(to top, #fff59d 50%, transparent 50%); }

        /* ì˜¤ë””ì˜¤ í”Œë ˆì´ì–´ */
        .audio-player-bar {
            position: absolute; bottom: 0; left: 0; right: 0; height: 80px; background: white; border-top: 1px solid #ddd;
            display: flex; align-items: center; padding: 0 25px; gap: 20px; box-shadow: 0 -4px 20px rgba(0,0,0,0.05);
            display: none; z-index: 200;
        }
        .audio-player-bar.visible { display: flex; }
        .play-btn { width: 48px; height: 48px; background: #2196f3; border-radius: 50%; display: flex; justify-content: center; align-items: center; color: white; font-size: 20px; cursor: pointer; box-shadow: 0 4px 10px rgba(33, 150, 243, 0.4); transition: 0.2s; }
        .play-btn:hover { transform: scale(1.05); }
        .timeline-box { flex: 1; display: flex; flex-direction: column; gap: 8px; }
        .timeline-bg { height: 6px; background: #eee; border-radius: 3px; position: relative; overflow: hidden; cursor: pointer; }
        .timeline-fill { position: absolute; left: 0; top: 0; height: 100%; width: 0%; background: #2196f3; transition: width 0.2s linear; }
        .time-labels { display: flex; justify-content: space-between; font-size: 12px; color: #888; font-family: monospace; }
        
        /* ì‹±í¬ í•˜ì´ë¼ì´íŠ¸ íš¨ê³¼ */
        .active-context-bg { background-color: #fff9c4 !important; border-color: #fbc02d !important; box-shadow: 0 0 0 2px rgba(251, 192, 45, 0.3); }

    </style>
</head>
<body>

<div class="tablet-frame">
    <div class="left-panel">
        <div class="pdf-header">
            <span>ğŸ“š [Internal Med] Endocrinology_Ch04.pdf</span>
            <div class="pen-tools">
                <span style="margin-right: 8px;">Pen Color:</span>
                <div class="color-btn active" style="background: #ff3b30;" onclick="setPenColor('#ff3b30', this)"></div>
                <div class="color-btn" style="background: #007aff;" onclick="setPenColor('#007aff', this)"></div>
                <div class="color-btn" style="background: #34c759;" onclick="setPenColor('#34c759', this)"></div>
                <div class="color-btn" style="background: #333333;" onclick="setPenColor('#333333', this)"></div>
            </div>
            <span id="headerPageNum">Page 13 / 60</span>
        </div>
        
        <div class="pdf-viewer-container">
            <div class="nav-btn nav-prev disabled" onclick="changePage(-1)">â®</div>
            <div class="nav-btn nav-next" onclick="changePage(1)">â¯</div>

            <div class="pdf-page active" id="p13">
                <canvas class="drawing-layer" ondrop="drop(event)" ondragover="allowDrop(event)"></canvas>
                <div class="slide-content-wrapper">
                    <div class="slide-header">
                        <div class="slide-title">Diabetic Ketoacidosis (DKA)</div>
                        <div class="slide-sub">Endocrinology Part.4</div>
                    </div>
                    <div class="content-block">
                        <div class="section-title">1. Definition & Epidemiology</div>
                        <p class="text-body">
                            ì¸ìŠë¦°ì˜ ì ˆëŒ€ì  ê²°í•(Absolute deficiency)ê³¼ ëŒ€í•­ í˜¸ë¥´ëª¬(Counter-regulatory hormones)ì˜ ì¦ê°€ë¡œ ì¸í•´ ë°œìƒí•˜ëŠ” ê¸‰ì„± ëŒ€ì‚¬ í•©ë³‘ì¦ì´ë‹¤.
                        </p>
                    </div>
                    <div class="content-block">
                        <div class="section-title">2. Pathophysiology (ë³‘íƒœìƒë¦¬)</div>
                        <p class="text-body">
                            <strong>(1) Hyperglycemia:</strong> Gluconeogenesis ì¦ê°€.<br>
                            <strong>(2) Ketosis:</strong> Lipolysis ì¦ê°€ â†’ Free Fatty Acid â†’ Ketone bodies ìƒì„±.<br>
                        </p>
                        <div class="info-box">
                            <strong>ğŸ’¡ Key Mechanism:</strong> High Anion Gap Metabolic Acidosis (HAGMA)
                        </div>
                    </div>
                </div>
                <div class="dropped-note" style="top:450px; left:450px;" onclick="focusChat('chat-13-1')">ğŸ“Œ AI ë©”ëª¨: ë³‘íƒœìƒë¦¬ í•µì‹¬ ìš”ì•½</div>
            </div>

            <div class="pdf-page" id="p14">
                <canvas class="drawing-layer" ondrop="drop(event)" ondragover="allowDrop(event)"></canvas>
                <div class="slide-content-wrapper">
                    <div class="slide-header">
                        <div class="slide-title">Precipitating Factors</div>
                        <div class="slide-sub">What triggers DKA?</div>
                    </div>
                    <div class="content-block">
                        <div class="section-title">Common Triggers (ìœ ë°œ ì¸ì)</div>
                        <p class="text-body">
                            <ul>
                                <li><strong>Infection (m/c, 30-40%):</strong> Pneumonia, UTI, Sepsis.</li>
                                <li><strong>Insulin Omission:</strong> í™˜ìì˜ ì„ì˜ íˆ¬ì—¬ ì¤‘ë‹¨.</li>
                            </ul>
                        </p>
                    </div>
                    <div class="warn-box">
                        <strong>âš ï¸ Clinical Pearl:</strong> ë°±í˜ˆêµ¬ ì¦ê°€(Leukocytosis)ëŠ” ê°ì—¼ ì—†ì´ DKA ìì²´ë¡œ ë‚˜íƒ€ë‚  ìˆ˜ ìˆë‹¤.
                    </div>
                </div>
            </div>

            <div class="pdf-page" id="p15">
                <canvas class="drawing-layer" ondrop="drop(event)" ondragover="allowDrop(event)"></canvas>
                 <div class="slide-content-wrapper">
                    <div class="slide-header">
                        <div class="slide-title">Clinical Features</div>
                        <div class="slide-sub">Symptoms & Signs</div>
                    </div>
                    <div class="content-block">
                        <div class="section-title">Symptoms</div>
                        <p class="text-body">
                            - Polyuria, Polydipsia, Weight loss<br>
                            - <strong>GI Symptoms:</strong> Nausea, Vomiting, Abdominal Pain (ê¸‰ì„± ë³µì¦ê³¼ ê°ë³„)
                        </p>
                    </div>
                    <div class="content-block">
                        <div class="section-title">Physical Findings</div>
                        <p class="text-body">
                            - Dehydration<br>
                            - <strong>Kussmaul Respiration:</strong> Rapid & Deep breathing.<br>
                            - Acetone breath odor.
                        </p>
                    </div>
                </div>
            </div>

            <div class="pdf-page" id="p16">
                <canvas class="drawing-layer" ondrop="drop(event)" ondragover="allowDrop(event)"></canvas>
                <div class="slide-content-wrapper">
                    <div class="slide-header">
                        <div class="slide-title">Diagnosis & Lab Findings</div>
                        <div class="slide-sub">Diagnostic Criteria</div>
                    </div>
                    <table class="lab-table">
                        <tr><th>Test</th><th>DKA Criteria</th></tr>
                        <tr><td>Plasma Glucose</td><td>> 250 mg/dL</td></tr>
                        <tr><td>Arterial pH</td><td>< 7.30</td></tr>
                        <tr><td>Serum Bicarb</td><td>< 18 mEq/L</td></tr>
                        <tr><td>Urine/Serum Ketone</td><td>Positive</td></tr>
                        <tr><td>Anion Gap</td><td>> 10~12</td></tr>
                    </table>
                    <div class="info-box">
                        <strong>Formula:</strong> Anion Gap = $Na^+ - (Cl^- + HCO_3^-)$
                    </div>
                </div>
                <div class="dropped-note" style="top:500px; left:400px;" onclick="focusChat('chat-16-1')">ğŸ“Œ AI ë©”ëª¨: AG ê³„ì‚°ë²•</div>
            </div>

            <div class="pdf-page" id="p17">
                <canvas class="drawing-layer" ondrop="drop(event)" ondragover="allowDrop(event)"></canvas>
                <div class="slide-content-wrapper">
                    <div class="slide-header">
                        <div class="slide-title">Management: Fluid Therapy</div>
                        <div class="slide-sub">Step 1. Hydration</div>
                    </div>
                    <div class="content-block">
                        <div class="section-title">Fluid Resuscitation Protocol</div>
                        <p class="text-body">
                            <strong>1. Initial:</strong> 0.9% Normal Saline (NS) 1,000mL in first hour.<br>
                            <strong>2. Subsequent:</strong> Corrected $Na^+$ í™•ì¸ í›„ ê²°ì •.<br>
                        </p>
                    </div>
                </div>
            </div>

            <div class="pdf-page" id="p18">
                <canvas class="drawing-layer" ondrop="drop(event)" ondragover="allowDrop(event)"></canvas>
                <div class="slide-content-wrapper">
                    <div class="slide-header">
                        <div class="slide-title">Management: Potassium ($K^+$)</div>
                        <div class="slide-sub">Step 2. Electrolyte Correction</div>
                    </div>
                    <div class="warn-box">
                        <strong>ğŸš¨ CRITICAL STEP: Check $K^+$ before Insulin!</strong><br>
                        ì‹¬ê°í•œ Hypokalemia ë° ë¶€ì •ë§¥(Arrhythmia) ìœ ë°œ ê°€ëŠ¥.
                    </div>
                    <div class="content-block">
                        <div class="section-title">Potassium Replacement Guide</div>
                        <p class="text-body">
                            1) <strong>$K^+$ < 3.3 mEq/L:</strong> <span style="color:red; font-weight:bold;">HOLD Insulin!</span> Give KCl.<br>
                            2) <strong>$K^+$ 3.3 ~ 5.2 mEq/L:</strong> Give KCl per liter of IV fluid.<br>
                            3) <strong>$K^+$ > 5.2 mEq/L:</strong> Do not give K.
                        </p>
                    </div>
                </div>
                <div class="dropped-note" style="top:350px; left:50%;" onclick="focusChat('chat-18-1')">ğŸ“Œ AI ë©”ëª¨: ì¸ìŠë¦° íˆ¬ì—¬ ê¸ˆê¸°ì‚¬í•­</div>
            </div>

            <div class="pdf-page" id="p19">
                <canvas class="drawing-layer" ondrop="drop(event)" ondragover="allowDrop(event)"></canvas>
                <div class="slide-content-wrapper">
                    <div class="slide-header">
                        <div class="slide-title">Management: Insulin Therapy</div>
                        <div class="slide-sub">Step 3. Reverse Ketosis</div>
                    </div>
                    <div class="content-block">
                        <div class="section-title">IV Regular Insulin (RI)</div>
                        <p class="text-body">
                            - <strong>Loading:</strong> 0.1 unit/kg IV bolus.<br>
                            - <strong>Maintenance:</strong> 0.1 unit/kg/hr IV continuous.<br>
                        </p>
                    </div>
                </div>
            </div>

            <div class="pdf-page" id="p20">
                <canvas class="drawing-layer" ondrop="drop(event)" ondragover="allowDrop(event)"></canvas>
                <div class="slide-content-wrapper">
                    <div class="slide-header">
                        <div class="slide-title">Complications of Therapy</div>
                        <div class="slide-sub">What to watch out for</div>
                    </div>
                    <div class="content-block">
                        <div class="section-title">Cerebral Edema (ë‡Œë¶€ì¢…)</div>
                        <p class="text-body">
                            - ì£¼ë¡œ ì†Œì•„/ì²­ì†Œë…„ì—ì„œ ë°œìƒ. ê¸‰ê²©í•œ ì‚¼íˆ¬ì•• ì €í•˜ê°€ ì›ì¸.<br>
                            - ì¦ìƒ: ë‘í†µ, ì˜ì‹ ì €í•˜, êµ¬í† .<br>
                            - ì¹˜ë£Œ: <strong>Mannitol</strong> IV.
                        </p>
                    </div>
                </div>
            </div>

            <div class="pdf-page" id="p21">
                 <canvas class="drawing-layer" ondrop="drop(event)" ondragover="allowDrop(event)"></canvas>
                 <div class="slide-content-wrapper">
                    <div class="slide-header">
                        <div class="slide-title">HHS (Hyperosmolar Hyperglycemic State)</div>
                        <div class="slide-sub">Comparison with DKA</div>
                    </div>
                    <table class="lab-table">
                        <tr><th>Feature</th><th>DKA</th><th>HHS</th></tr>
                        <tr><td>Glucose</td><td>> 250</td><td>> 600</td></tr>
                        <tr><td>pH / Bicarb</td><td>Low</td><td>Normal</td></tr>
                        <tr><td>Ketones</td><td>Positive</td><td>Negative</td></tr>
                        <tr><td>Osmolality</td><td>Variable</td><td>> 320</td></tr>
                    </table>
                </div>
            </div>

            <div class="pdf-page" id="p22">
                <canvas class="drawing-layer" ondrop="drop(event)" ondragover="allowDrop(event)"></canvas>
                <div class="slide-content-wrapper">
                    <div class="slide-header">
                        <div class="slide-title">Sick Day Management</div>
                        <div class="slide-sub">Patient Education</div>
                    </div>
                    <div class="content-block">
                        <p class="text-body">
                            1. <strong>Never Stop Insulin:</strong> ì‹ì‚¬ë¥¼ ëª» í•´ë„ ì¸ìŠë¦° ì¤‘ë‹¨ ê¸ˆì§€.<br>
                            2. <strong>Frequent Monitoring:</strong> 4ì‹œê°„ë§ˆë‹¤ í˜ˆë‹¹/ì¼€í†¤ ì¸¡ì •.<br>
                            3. <strong>Hydration:</strong> ìˆ˜ë¶„ ì„­ì·¨ ê¶Œì¥.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="right-panel">
        <div class="tabs">
            <div class="tab active" onclick="showTab('tab-chat')">AI ì±„íŒ…</div>
            <div class="tab" onclick="showTab('tab-jokbo')">ê´€ë ¨ ì¡±ë³´</div>
            <div class="tab" onclick="showTab('tab-script')">ë…¹ìŒ ìŠ¤í¬ë¦½íŠ¸</div>
        </div>

        <div class="tab-content-container">
            <div id="tab-chat" class="tab-content active">
                <div class="chat-container">
                    <div class="msg-group" id="chat-13-1">
                        <div class="msg-meta"><span>Page 13</span><span>â€¢</span><span>ë³‘íƒœìƒë¦¬</span></div>
                        <div class="bubble user-msg">DKAì˜ í•µì‹¬ ê¸°ì „ì´ ë­ì•¼?</div>
                        <div class="bubble ai-msg" draggable="true" ondragstart="drag(event)">
                            <strong>3ëŒ€ ìš”ì†Œ</strong>ê°€ í•µì‹¬ì…ë‹ˆë‹¤.<br>
                            1. ì¸ìŠë¦° ê²°í• (Insulin deficiency)<br>
                            2. ëŒ€í•­ í˜¸ë¥´ëª¬ ì¦ê°€ (Counter-regulatory hormones â†‘)<br>
                            ì´ë¡œ ì¸í•´ <strong>ì§€ë°© ë¶„í•´(Lipolysis)</strong>ê°€ ê°€ì†í™”ë˜ê³ , ê°„ì—ì„œ ì¼€í†¤ì²´ê°€ ìƒì„±ë˜ì–´ <strong>ëŒ€ì‚¬ì„± ì‚°ì¦</strong>ì´ ë°œìƒí•©ë‹ˆë‹¤.
                        </div>
                    </div>
                    
                    <div class="msg-group" id="chat-14-1">
                        <div class="msg-meta"><span>Page 14</span><span>â€¢</span><span>ì„ìƒì¦ìƒ</span></div>
                        <div class="bubble user-msg">ê°ì—¼ ì§•í›„ê°€ ì—†ëŠ”ë° ë°±í˜ˆêµ¬ê°€ ë†’ì„ ìˆ˜ ìˆì–´?</div>
                        <div class="bubble ai-msg" draggable="true" ondragstart="drag(event)">
                            ë„¤, ê°€ëŠ¥í•©ë‹ˆë‹¤. DKA ìì²´ê°€ ê·¹ì‹¬í•œ ìŠ¤íŠ¸ë ˆìŠ¤ ìƒí™©ì´ë¯€ë¡œ ì½”í‹°ì†”ê³¼ ì¹´í…Œì½œì•„ë¯¼ì´ ë¶„ë¹„ë˜ì–´ <strong>ë°˜ì‘ì„± ë°±í˜ˆêµ¬ ì¦ê°€(Leukocytosis)</strong>ê°€ ë‚˜íƒ€ë‚©ë‹ˆë‹¤.
                        </div>
                    </div>

                    <div class="msg-group" id="chat-16-1">
                        <div class="msg-meta"><span>Page 16</span><span>â€¢</span><span>Lab</span></div>
                        <div class="bubble user-msg">Anion Gap ê³„ì‚° ê³µì‹ ì•Œë ¤ì¤˜.</div>
                        <div class="bubble ai-msg" draggable="true" ondragstart="drag(event)">
                            $AG = Na^+ - (Cl^- + HCO_3^-)$ ì…ë‹ˆë‹¤.<br>
                            ì •ìƒì¹˜ëŠ” 12Â±2 ì´ë©°, DKAì—ì„œëŠ” High AG Metabolic Acidosis ì†Œê²¬ì„ ë³´ì…ë‹ˆë‹¤.
                        </div>
                    </div>

                    <div class="msg-group" id="chat-18-1">
                        <div class="msg-meta"><span>Page 18</span><span>â€¢</span><span>ì£¼ì˜ì‚¬í•­</span></div>
                        <div class="bubble user-msg">K ìˆ˜ì¹˜ 3.0ì¸ë° ì¸ìŠë¦° ì£¼ë©´?</div>
                        <div class="bubble ai-msg" draggable="true" ondragstart="drag(event)">
                            <strong>ì ˆëŒ€ ì•ˆ ë©ë‹ˆë‹¤!</strong><br>
                            ì¸ìŠë¦°ì´ Kë¥¼ ì„¸í¬ ì•ˆìœ¼ë¡œ ë°€ì–´ë„£ì–´ ìˆ˜ì¹˜ê°€ ë” ë–¨ì–´ì§€ë©´ <strong>ì‹¬ì‹¤ ë¶€ì •ë§¥(V-fib)</strong>ìœ¼ë¡œ ì‚¬ë§í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                        </div>
                    </div>

                    </div>
            </div>

            <div id="tab-jokbo" class="tab-content">
                <div style="font-size:12px; color:#888; margin-bottom:15px;">â€» ìµœê·¼ 5ê°œë…„ ê¸°ì¶œë¬¸ì œ ê¸°ë°˜</div>

                <div class="jokbo-card p13-item visible">
                    <div class="badge-row"><span class="badge year">23ë…„ 2ì°¨</span><span class="badge freq">â˜…ë¹ˆì¶œ</span></div>
                    <div class="q-body">Q. ì œ1í˜• ë‹¹ë‡¨ë³‘ í™˜ìì—ì„œ DKA ë°œìƒ ì‹œ ì¦ê°€í•˜ëŠ” í˜¸ë¥´ëª¬ì´ ì•„ë‹Œ ê²ƒì€?</div>
                    <div class="q-options">
                        <div>â‘  Glucagon</div>
                        <div>â‘¡ Cortisol</div>
                        <div>â‘¢ Growth Hormone</div>
                        <div>â‘£ <strong>Insulin</strong> (ì •ë‹µ)</div>
                    </div>
                </div>
                </div>

            <div id="tab-script" class="tab-content">
                <div class="script-segment" id="script-13-1">
                    <div class="script-header"><span class="speaker-name">êµìˆ˜ë‹˜</span><span>09:30</span></div>
                    <div class="script-text">
                        ì, ì˜¤ëŠ˜ ìˆ˜ì—…ì€ <span class="highlight-text">DKA</span>ì…ë‹ˆë‹¤. í•µì‹¬ì€ ì¸ìŠë¦°ì´ 'ì•„ì˜ˆ' ì—†ë‹¤ëŠ” ê²ë‹ˆë‹¤. ê·¸ë˜ì„œ ìš°ë¦¬ ëª¸ì´ ì§€ë°©ì„ íƒœìš°ê³  'ì¼€í†¤'ì´ ë‚˜ì™€ì„œ í”¼ê°€ ì‚°ì„±ì´ ë˜ëŠ” ê±°ì£ .
                    </div>
                </div>
                <div class="script-segment" id="script-18-1">
                    <div class="script-header"><span class="speaker-name">êµìˆ˜ë‹˜</span><span>10:25</span></div>
                    <div class="script-text">
                        ì—¬ê¸° ë³„í‘œ ë‹¤ì„¯ ê°œ ì¹˜ì„¸ìš”. <strong>K ìˆ˜ì¹˜ ì•ˆ ë³´ê³  ì¸ìŠë¦° ì£¼ë©´ ì‚´ì¸ì…ë‹ˆë‹¤.</strong> í˜ˆì¤‘ Kê°€ ëš ë–¨ì–´ì ¸ì„œ ì‹¬ì¥ ë©ìŠµë‹ˆë‹¤. 3.3 ê¸°ì–µí•˜ì„¸ìš”.
                    </div>
                </div>
                 </div>
        </div>

        <div class="audio-player-bar" id="audioPlayer">
            <div class="play-btn">â–¶</div>
            <div class="timeline-box">
                <div class="timeline-bg"><div class="timeline-fill" id="audioProgress"></div></div>
                <div class="time-labels"><span id="currentTime">09:30</span><span>12:00</span></div>
            </div>
            <div class="speed-control" style="font-weight:700; color:#555; cursor:pointer;">1.2x</div>
        </div>
    </div>
</div>

<script>
    // [10í˜ì´ì§€ ë°ì´í„° ì„¤ì •]
    const pages = ['p13', 'p14', 'p15', 'p16', 'p17', 'p18', 'p19', 'p20', 'p21', 'p22'];
    let currentPageIdx = 0;

    // --- [ë“œë¡œì‰(í•„ê¸°) ê´€ë ¨ ë³€ìˆ˜ ë° í•¨ìˆ˜] ---
    let isDrawing = false;
    let lastX = 0;
    let lastY = 0;
    let currentPenColor = '#ff3b30'; // ê¸°ë³¸ íœ ìƒ‰ìƒ (ë¹¨ê°•)
    const penWidth = 3; // íœ ë‘ê»˜

    // íœ ìƒ‰ìƒ ë³€ê²½ í•¨ìˆ˜
    function setPenColor(color, element) {
        currentPenColor = color;
        document.querySelectorAll('.color-btn').forEach(btn => btn.classList.remove('active'));
        element.classList.add('active');
    }

    // ìº”ë²„ìŠ¤ ì´ˆê¸°í™” (í•´ìƒë„ ë§ì¶”ê¸°)
    function resizeCanvas(canvas) {
        // ìº”ë²„ìŠ¤ì˜ í‘œì‹œ í¬ê¸°ì™€ ë‚´ë¶€ í•´ìƒë„ë¥¼ ì¼ì¹˜ì‹œì¼œì•¼ ì„ ì´ ì„ ëª…í•˜ê²Œ ë³´ì„
        const rect = canvas.getBoundingClientRect();
        canvas.width = rect.width;
        canvas.height = rect.height;
    }

    // ëª¨ë“  ìº”ë²„ìŠ¤ì— ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
    function initDrawing() {
        const canvases = document.querySelectorAll('.drawing-layer');
        canvases.forEach(canvas => {
            const ctx = canvas.getContext('2d');
            
            // í˜ì´ì§€ê°€ ì²˜ìŒ ë¡œë“œë  ë•Œ ìº”ë²„ìŠ¤ í¬ê¸° ì„¤ì •
            // (ì‹¤ì œë¡œëŠ” í˜ì´ì§€ê°€ display:block ë  ë•Œë§ˆë‹¤ í•´ì£¼ëŠ” ê²Œ ê°€ì¥ ì •í™•í•¨)
            // ì—¬ê¸°ì„œëŠ” ê°„ë‹¨íˆ ì´ˆê¸°í™” ì‹œì ì— ì‹œë„í•˜ê³ , changePageì—ì„œ ë³´ì™„
            setTimeout(() => resizeCanvas(canvas), 100); 

            function draw(e) {
                if (!isDrawing) return;
                
                // ë§ˆìš°ìŠ¤ ì¢Œí‘œ ê³„ì‚° (ìº”ë²„ìŠ¤ ê¸°ì¤€ ìƒëŒ€ ì¢Œí‘œ)
                const rect = canvas.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                
                ctx.beginPath();
                ctx.moveTo(lastX, lastY);
                ctx.lineTo(x, y);
                ctx.strokeStyle = currentPenColor;
                ctx.lineWidth = penWidth;
                ctx.lineCap = 'round'; // ì„  ëì„ ë‘¥ê¸€ê²Œ
                ctx.lineJoin = 'round'; // êº¾ì´ëŠ” ë¶€ë¶„ì„ ë‘¥ê¸€ê²Œ
                ctx.stroke();
                
                [lastX, lastY] = [x, y];
            }

            canvas.addEventListener('mousedown', (e) => {
                isDrawing = true;
                const rect = canvas.getBoundingClientRect();
                [lastX, lastY] = [e.clientX - rect.left, e.clientY - rect.top];
            });

            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', () => isDrawing = false);
            canvas.addEventListener('mouseout', () => isDrawing = false);
            
            // í„°ì¹˜ ì§€ì› (íƒœë¸”ë¦¿ ë“±)
            canvas.addEventListener('touchstart', (e) => {
                e.preventDefault(); // ìŠ¤í¬ë¡¤ ë°©ì§€
                isDrawing = true;
                const rect = canvas.getBoundingClientRect();
                const touch = e.touches[0];
                [lastX, lastY] = [touch.clientX - rect.left, touch.clientY - rect.top];
            }, { passive: false });

            canvas.addEventListener('touchmove', (e) => {
                e.preventDefault();
                const touch = e.touches[0];
                draw(touch);
            }, { passive: false });

             canvas.addEventListener('touchend', () => isDrawing = false);
        });
    }

    // ì´ˆê¸°í™” ì‹¤í–‰
    window.addEventListener('load', initDrawing);


    // [í˜ì´ì§€ ë³€ê²½ ë¡œì§]
    function changePage(direction) {
        const nextIdx = currentPageIdx + direction;
        if (nextIdx < 0 || nextIdx >= pages.length) return;

        document.getElementById(pages[currentPageIdx]).classList.remove('active');
        currentPageIdx = nextIdx;
        const newPageId = pages[currentPageIdx];
        const newPageEl = document.getElementById(newPageId);
        newPageEl.classList.add('active');
        
        // í˜ì´ì§€ê°€ ë³´ì—¬ì§ˆ ë•Œ ìº”ë²„ìŠ¤ í¬ê¸°ë¥¼ ë‹¤ì‹œ ë§ì¶°ì•¼ ê¹¨ì§€ì§€ ì•ŠìŒ
        const activeCanvas = newPageEl.querySelector('.drawing-layer');
        if(activeCanvas) resizeCanvas(activeCanvas);

        const pageNum = newPageId.replace('p', '');
        document.getElementById('headerPageNum').innerText = `Page ${pageNum} / 60`;
        
        document.querySelector('.nav-prev').classList.toggle('disabled', currentPageIdx === 0);
        document.querySelector('.nav-next').classList.toggle('disabled', currentPageIdx === pages.length - 1);

        syncRightPanel(pageNum);
    }

    // [ì»¨í…ì¸  ë™ê¸°í™” ë§¤í•‘] (ê¸°ì¡´ ë¡œì§ ìœ ì§€)
    function syncRightPanel(pageNum) {
        document.querySelectorAll('.jokbo-card').forEach(card => card.classList.remove('visible'));
        document.querySelectorAll(`.p${pageNum}-item`).forEach(card => card.classList.add('visible'));
        // (ë‚˜ë¨¸ì§€ syncMap ë¡œì§ì€ ë™ì¼í•˜ì—¬ ìƒëµ)
    }


    // [íƒ­ ì „í™˜] (ê¸°ì¡´ ë¡œì§ ìœ ì§€)
    function showTab(tabId) {
        document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
        document.getElementById(tabId).classList.add('active');
        
        document.querySelectorAll('.tab').forEach(el => el.classList.remove('active'));
        const tabs = ['tab-chat', 'tab-jokbo', 'tab-script'];
        document.querySelectorAll('.tab')[tabs.indexOf(tabId)].classList.add('active');

        const player = document.getElementById('audioPlayer');
        if (tabId === 'tab-script') player.classList.add('visible');
        else player.classList.remove('visible');
    }

    // [Drag & Drop ìˆ˜ì •]
    // ìº”ë²„ìŠ¤ ìœ„ë¡œ ë“œë¡­ë˜ë¯€ë¡œ, ì´ë²¤íŠ¸ íƒ€ê²Ÿì´ ìº”ë²„ìŠ¤ì„. ë¶€ëª¨ ìš”ì†Œ(pdf-page)ë¥¼ ì°¾ì•„ ë©”ëª¨ë¥¼ ë¶™ì—¬ì•¼ í•¨.
    function drag(ev) { ev.dataTransfer.setData("chatId", ev.target.id); ev.dataTransfer.setData("text", ev.target.innerText); }
    function allowDrop(ev) { ev.preventDefault(); }
    function drop(ev) {
        ev.preventDefault();
        const chatId = ev.dataTransfer.getData("chatId"); 
        const tempDiv = document.createElement("div"); tempDiv.innerHTML = ev.dataTransfer.getData("text");
        const cleanText = tempDiv.textContent || tempDiv.innerText || "";
        
        // ë“œë¡­ëœ ëŒ€ìƒ(ìº”ë²„ìŠ¤)ì˜ ë¶€ëª¨ ìš”ì†Œ(pdf-page) ì°¾ê¸°
        const pdfPage = ev.target.closest('.pdf-page');
        const rect = pdfPage.getBoundingClientRect();
        
        const note = document.createElement("div");
        note.className = "dropped-note"; 
        note.innerHTML = `ğŸ“Œ <strong>AI ë©”ëª¨</strong><br>${cleanText.substring(0, 30)}...`;
        // ìº”ë²„ìŠ¤ ìœ„ì—ì„œì˜ ì¢Œí‘œë¥¼ ë¶€ëª¨ ê¸°ì¤€ ìƒëŒ€ ì¢Œí‘œë¡œ ê³„ì‚°
        note.style.left = (ev.clientX - rect.left) + "px"; 
        note.style.top = (ev.clientY - rect.top) + "px";
        note.onclick = () => focusChat(chatId);
        
        // ìº”ë²„ìŠ¤ê°€ ì•„ë‹Œ pdf-pageì— append
        pdfPage.appendChild(note);
    }

    function focusChat(elementId) {
        showTab('tab-chat');
        const el = document.getElementById(elementId);
        if(el) {
            document.querySelector('.tab-content-container').scrollTo({ top: el.offsetTop - 80, behavior: 'smooth' });
            el.classList.add('active-context-bg');
            setTimeout(() => { el.classList.remove('active-context-bg'); }, 2000);
        }
    }
</script>
</body>
</html>
