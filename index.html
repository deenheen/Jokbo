<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Med-Study OS v10.4 (Navigation Fix & Rich AI)</title>
    <style>
        /* [ê¸°ë³¸ ìŠ¤íƒ€ì¼ & í°íŠ¸] */
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');
        @import url('https://fonts.googleapis.com/css2?family=Nanum+Pen+Script&display=swap');
        
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Pretendard', sans-serif; }
        body { background-color: #eaeff5; height: 100vh; display: flex; justify-content: center; align-items: center; overflow: hidden; user-select: none; }

        /* ì»¤ìŠ¤í…€ ìŠ¤í¬ë¡¤ë°” */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

        /* --- [1. í™ˆ í™”ë©´ (Dashboard)] --- */
        #home-screen {
            width: 100%; height: 100%; display: flex; flex-direction: column; 
            justify-content: center; align-items: center; 
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            z-index: 2000; position: absolute; top: 0; left: 0;
            transition: opacity 0.5s ease-out, transform 0.5s ease-out;
        }
        #home-screen.hidden { opacity: 0; transform: scale(1.1); pointer-events: none; }

        .home-card {
            background: rgba(255, 255, 255, 0.95); padding: 60px 80px; border-radius: 32px;
            box-shadow: 0 30px 80px rgba(0,0,0,0.12); backdrop-filter: blur(10px);
            text-align: center; width: 1000px; max-width: 90%; border: 1px solid rgba(255,255,255,0.5);
        }

        .home-title { font-size: 36px; font-weight: 800; color: #1e293b; margin-bottom: 12px; letter-spacing: -0.5px; }
        .home-subtitle { font-size: 16px; color: #64748b; margin-bottom: 60px; font-weight: 500; }

        .upload-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 24px; margin-bottom: 60px; }

        .upload-item {
            border: 2px dashed #cbd5e1; border-radius: 20px; padding: 40px 20px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            cursor: pointer; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); position: relative; overflow: hidden;
            background: #fff;
        }
        .upload-item:hover { border-color: #3b82f6; background: #eff6ff; transform: translateY(-8px); box-shadow: 0 10px 25px rgba(59, 130, 246, 0.1); }
        .upload-item.completed { border-style: solid; border-color: #22c55e; background: #f0fdf4; }

        .upload-icon { font-size: 48px; margin-bottom: 20px; filter: grayscale(100%); transition: 0.3s; }
        .upload-item:hover .upload-icon { filter: grayscale(0%); transform: scale(1.1); }
        .upload-label { font-size: 16px; font-weight: 700; color: #334155; margin-bottom: 8px; }
        .upload-desc { font-size: 13px; color: #94a3b8; }
        
        .check-mark {
            position: absolute; top: 12px; right: 12px; 
            width: 28px; height: 28px; background: #22c55e; color: white; 
            border-radius: 50%; font-size: 16px; display: none; 
            align-items: center; justify-content: center; box-shadow: 0 4px 10px rgba(34, 197, 94, 0.3);
        }
        .upload-item.completed .check-mark { display: flex; animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }

        @keyframes popIn { from { transform: scale(0); } to { transform: scale(1); } }

        .start-btn {
            background: #3b82f6; color: white; padding: 18px 70px; 
            border-radius: 60px; font-size: 18px; font-weight: 700; border: none;
            cursor: pointer; box-shadow: 0 10px 30px rgba(59, 130, 246, 0.4);
            transition: all 0.3s; opacity: 0.5; pointer-events: none; transform: translateY(0);
        }
        .start-btn.active { opacity: 1; pointer-events: auto; }
        .start-btn:hover { background: #2563eb; transform: translateY(-3px); box-shadow: 0 15px 35px rgba(37, 99, 235, 0.5); }


        /* --- [2. ë©”ì¸ ì•±] --- */
        #main-app {
            opacity: 0; transition: opacity 0.8s ease-in; display: none;
            width: 100%; height: 100vh; justify-content: center; align-items: center;
        }
        #main-app.visible { opacity: 1; display: flex; }

        .tablet-frame {
            width: 1600px; height: 950px; background: white; border-radius: 24px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25); border: 8px solid #1e293b; display: flex; overflow: hidden;
        }

        /* --- [ì™¼ìª½: PDF ë·°ì–´] --- */
        .left-panel {
            flex: 1.6; background-color: #f1f5f9; display: flex; flex-direction: column;
            border-right: 1px solid #e2e8f0; position: relative;
        }
        
        .pdf-header {
            height: 56px; background: #fff; color: #334155; display: flex; align-items: center;
            padding: 0 24px; justify-content: space-between; font-size: 14px; font-weight: 600; 
            border-bottom: 1px solid #e2e8f0; z-index: 10;
        }

        .edit-mode-btn {
            padding: 8px 14px; background: #f1f5f9; border-radius: 8px; cursor: pointer; transition: 0.2s; display: flex; align-items: center; gap: 8px; border: 1px solid transparent;
        }
        .edit-mode-btn:hover { background: #e2e8f0; }
        .edit-mode-btn.active { background: #eff6ff; color: #3b82f6; border-color: #bfdbfe; }

        .drawing-toolbar {
            position: absolute; top: 66px; left: 50%; transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(8px);
            padding: 8px 16px; border-radius: 100px;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 0 0 1px rgba(0,0,0,0.05); 
            display: none; gap: 12px; z-index: 100;
        }
        .drawing-toolbar.visible { display: flex; animation: slideDown 0.2s cubic-bezier(0.16, 1, 0.3, 1); }
        @keyframes slideDown { from { opacity: 0; transform: translate(-50%, -10px); } to { opacity: 1; transform: translate(-50%, 0); } }

        .tool-btn {
            width: 40px; height: 40px; border-radius: 50%; border: 2px solid transparent;
            display: flex; justify-content: center; align-items: center; font-size: 20px; cursor: pointer; transition: 0.2s; color: #64748b; background: transparent;
        }
        .tool-btn:hover { background: #f1f5f9; color: #334155; }
        .tool-btn.active { background: #eff6ff; color: #3b82f6; border-color: #dbeafe; }
        .tool-btn.undo-btn:active { transform: scale(0.9); background: #e2e8f0; }

        .pdf-viewer-container {
            flex: 1; position: relative; overflow: hidden; background: #cbd5e1;
            display: flex; justify-content: center; align-items: center; padding: 30px;
        }

        .page-wrapper {
            width: 100%; height: 100%; max-width: 840px; max-height: 1188px;
            position: absolute; display: none; box-shadow: 0 20px 40px -5px rgba(0,0,0,0.2);
            border-radius: 4px;
        }
        .page-wrapper.active { display: block; animation: fadeIn 0.3s ease-out; }

        .pdf-page {
            width: 100%; height: 100%; background: white; padding: 50px 60px;
            position: absolute; top: 0; left: 0; display: flex; flex-direction: column; overflow-y: auto; z-index: 1;
            border-radius: 4px;
        }
        .drawing-canvas {
            position: absolute; top: 0; left: 0; z-index: 5; pointer-events: none; 
            touch-action: none; width: 100%; height: 100%;
        }
        .left-panel.drawing-mode .drawing-canvas { pointer-events: auto; cursor: crosshair; }
        .left-panel.drawing-mode .pdf-page { pointer-events: none; }

        @keyframes fadeIn { from { opacity: 0; transform: scale(0.98); } to { opacity: 1; transform: scale(1); } }

        /* PDF ìŠ¤íƒ€ì¼ */
        .slide-header { border-bottom: 3px solid #1e40af; padding-bottom: 12px; margin-bottom: 30px; display: flex; justify-content: space-between; align-items: flex-end; }
        .slide-title { font-size: 28px; font-weight: 800; color: #1e3a8a; letter-spacing: -0.5px; }
        .slide-sub { font-size: 15px; color: #64748b; font-weight: 600; }
        .content-block { margin-bottom: 28px; }
        .section-title { font-size: 18px; font-weight: 700; color: #1e293b; margin-bottom: 10px; display: flex; align-items: center; }
        .section-title::before { content: ""; display: inline-block; width: 5px; height: 18px; background: #2563eb; margin-right: 10px; border-radius: 2px; }
        .text-body { font-size: 15px; line-height: 1.75; color: #334155; text-align: justify; letter-spacing: -0.3px; }
        .text-body strong { color: #0f172a; font-weight: 700; background: linear-gradient(180deg, transparent 65%, #bfdbfe 65%); }
        .text-body ul { padding-left: 20px; margin-top: 8px; }
        .text-body li { margin-bottom: 6px; }
        .slide-image-container { width: 100%; margin: 20px 0; border-radius: 8px; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.1); border: 1px solid #e2e8f0; background: #f8fafc; text-align: center; }
        .slide-image { width: 100%; height: auto; display: block; object-fit: cover; max-height: 350px; }
        .image-caption { padding: 10px; font-size: 12px; color: #64748b; font-style: italic; background: #f1f5f9; border-top: 1px solid #e2e8f0; }
        .info-box { background: #f0f9ff; border: 1px solid #bae6fd; padding: 16px; border-radius: 8px; font-size: 14px; margin: 16px 0; color: #0369a1; box-shadow: 0 2px 4px rgba(0,0,0,0.02); }
        .warn-box { background: #fef2f2; border: 1px solid #fecaca; padding: 16px; border-radius: 8px; font-size: 14px; margin: 16px 0; color: #b91c1c; font-weight: 600; box-shadow: 0 2px 4px rgba(0,0,0,0.02); }
        .lab-table { width: 100%; border-collapse: collapse; font-size: 14px; margin: 16px 0; border-radius: 8px; overflow: hidden; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .lab-table th { background: #f8fafc; padding: 12px; border-bottom: 2px solid #e2e8f0; text-align: center; font-weight: 700; color: #475569; }
        .lab-table td { padding: 12px; border-bottom: 1px solid #e2e8f0; text-align: center; color: #334155; background: #fff; }

        /* [ìˆ˜ì •] ë„¤ë¹„ê²Œì´ì…˜ ë²„íŠ¼ (z-index ë° ìœ„ì¹˜ ì¡°ì •) */
        .nav-btn {
            position: absolute; top: 50%; transform: translateY(-50%);
            width: 48px; height: 48px; background: rgba(255,255,255,0.9); color: #334155;
            border-radius: 50%; display: flex; justify-content: center; align-items: center;
            cursor: pointer; font-size: 20px; 
            z-index: 200; /* ìº”ë²„ìŠ¤(5), í¬ìŠ¤íŠ¸ì‡(50-60), íˆ´ë°”(100)ë³´ë‹¤ ë†’ê²Œ */
            transition: 0.2s; box-shadow: 0 4px 12px rgba(0,0,0,0.15); border: 1px solid #e2e8f0;
        }
        .nav-btn:hover { background: white; transform: translateY(-50%) scale(1.1); color: #2563eb; }
        .nav-prev { left: 24px; } 
        .nav-next { right: 24px; }
        .nav-btn.disabled { opacity: 0; pointer-events: none; }

        /* ë©”ëª¨ ìŠ¤íƒ€ì¼ */
        .dropped-note {
            position: absolute; width: 280px; background-color: #ffffff; 
            box-shadow: 0 10px 25px -5px rgba(0,0,0,0.15), 0 8px 10px -6px rgba(0,0,0,0.1); 
            border-radius: 12px; z-index: 50; display: flex; flex-direction: column;
            transition: transform 0.2s cubic-bezier(0.25, 0.8, 0.25, 1), box-shadow 0.2s;
            overflow: hidden; border: 1px solid rgba(0,0,0,0.06); font-family: 'Pretendard', sans-serif;
        }
        .dropped-note:hover { z-index: 60; transform: translateY(-2px); box-shadow: 0 15px 30px -5px rgba(0,0,0,0.2); }
        .dropped-note:active { transform: scale(0.98); }
        .note-header { background: #f8fafc; padding: 10px 14px; display: flex; justify-content: space-between; align-items: center; font-size: 13px; font-weight: 700; color: #475569; cursor: grab; border-bottom: 1px solid #f1f5f9; user-select: none; }
        .note-header:active { cursor: grabbing; }
        .note-header strong { color: #3b82f6; display: flex; align-items: center; gap: 6px; }
        .note-body { padding: 16px; font-size: 14px; color: #334155; line-height: 1.6; max-height: 320px; overflow-y: auto; white-space: pre-wrap; cursor: text; user-select: text; background-color: #fff; }
        .dropped-note.collapsed .note-body { display: none; }
        .dropped-note.collapsed { width: auto; max-width: 220px; }
        .note-toggle-btn { cursor: pointer; width: 24px; height: 24px; border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 10px; color: #94a3b8; background: transparent; transition: 0.2s; }
        .note-toggle-btn:hover { background: #e2e8f0; color: #475569; }

        .trash-drop-zone {
            position: absolute; bottom: 40px; left: 50%; transform: translateX(-50%) translateY(20px);
            width: 160px; height: 56px; background: rgba(15, 23, 42, 0.85); color: white;
            border-radius: 100px; display: flex; justify-content: center; align-items: center; gap: 8px;
            opacity: 0; pointer-events: none; transition: 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
            z-index: 200; font-weight: 600; font-size: 14px; backdrop-filter: blur(8px); box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }
        .trash-drop-zone.active { opacity: 1; transform: translateX(-50%) translateY(0); pointer-events: auto; }
        .trash-drop-zone.hover { background: #ef4444; transform: translateX(-50%) scale(1.1); box-shadow: 0 15px 30px rgba(239, 68, 68, 0.4); }

        /* --- [ì˜¤ë¥¸ìª½ íŒ¨ë„] --- */
        .right-panel { flex: 0.8; display: flex; flex-direction: column; background: #f8fafc; border-left: 1px solid #e2e8f0; position: relative; }
        .tabs { display: flex; background: white; border-bottom: 1px solid #e2e8f0; flex-shrink: 0; height: 56px; padding: 0 16px; gap: 8px; }
        .tab { flex: 1; display: flex; align-items: center; justify-content: center; cursor: pointer; font-weight: 600; color: #94a3b8; font-size: 14px; transition: 0.2s; border-bottom: 3px solid transparent; margin-top: 8px; }
        .tab:hover { color: #64748b; }
        .tab.active { color: #3b82f6; border-bottom-color: #3b82f6; }
        .tab-content-container { flex: 1; overflow-y: auto; position: relative; scroll-behavior: smooth; padding-top: 10px; }
        .tab-content { display: none; padding: 20px; padding-bottom: 100px; }
        .tab-content.active { display: block; animation: fadeIn 0.2s; }

        .chat-container { display: flex; flex-direction: column; gap: 20px; }
        .msg-group { display: flex; flex-direction: column; gap: 6px; cursor: pointer; transition: background 0.2s; padding: 8px; border-radius: 12px; }
        .msg-group:hover { background-color: #f1f5f9; }
        .msg-meta { font-size: 11px; color: #94a3b8; margin-left: 4px; display: flex; gap: 6px; font-weight: 500; }
        .bubble { max-width: 94%; padding: 16px 20px; border-radius: 16px; font-size: 15px; line-height: 1.65; box-shadow: 0 2px 4px rgba(0,0,0,0.03); }
        .user-msg { align-self: flex-end; background: #3b82f6; color: white; border-bottom-right-radius: 4px; }
        .ai-msg { align-self: flex-start; background: white; color: #334155; border: 1px solid #e2e8f0; border-bottom-left-radius: 4px; position: relative; padding-top: 30px; cursor: text; user-select: text; -webkit-user-select: text; }
        .ai-msg:hover { border-color: #bfdbfe; box-shadow: 0 4px 12px rgba(59, 130, 246, 0.1); }
        .ai-msg ul { padding-left: 18px; margin-top: 8px; }
        
        .chat-drag-handle { position: absolute; top: 0; left: 0; right: 0; height: 24px; background: #f8fafc; border-radius: 15px 15px 0 0; display: flex; justify-content: center; align-items: center; cursor: grab; color: #cbd5e1; font-size: 10px; letter-spacing: 2px; border-bottom: 1px solid #f1f5f9; user-select: none; }
        .chat-drag-handle:hover { background: #eff6ff; color: #3b82f6; }
        .chat-drag-handle:active { cursor: grabbing; }

        .jokbo-card { background: white; padding: 24px; border-radius: 16px; border: 1px solid #e2e8f0; margin-bottom: 16px; display: none; box-shadow: 0 2px 4px rgba(0,0,0,0.02); cursor: pointer; position: relative; transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); }
        .jokbo-card.visible { display: block; animation: fadeIn 0.3s; }
        #tab-jokbo.expanded .jokbo-card { display: block; animation: fadeIn 0.3s; }
        .jokbo-card:hover { transform: translateY(-3px); box-shadow: 0 10px 20px rgba(0, 0, 0, 0.05); border-color: #3b82f6; }
        
        .badge { display: inline-block; padding: 4px 10px; font-size: 11px; border-radius: 6px; font-weight: 700; margin-right: 6px; letter-spacing: -0.3px; }
        .badge.year { background: #eff6ff; color: #2563eb; } .badge.tag { background: #fdf4ff; color: #c026d3; } .badge.freq { background: #fef2f2; color: #dc2626; }
        .q-body { font-size: 15px; font-weight: 700; color: #1e293b; margin-bottom: 16px; line-height: 1.5; }
        .q-options { font-size: 14px; color: #475569; display: flex; flex-direction: column; gap: 6px; }
        .q-options div { cursor: pointer; padding: 8px 12px; border-radius: 6px; border: 1px solid transparent; transition: 0.1s; }
        .q-options div:hover { background: #f1f5f9; border-color: #cbd5e1; }
        .jokbo-actions { display: flex; gap: 10px; margin-top: 20px; padding-top: 16px; border-top: 1px dashed #e2e8f0; }
        .action-btn { flex: 1; padding: 10px 0; border: 1px solid #e2e8f0; background: #fff; border-radius: 8px; font-size: 12px; color: #64748b; cursor: pointer; text-align: center; transition: 0.2s; font-weight: 600; display: flex; align-items: center; justify-content: center; gap: 6px; }
        .action-btn:hover { background: #f8fafc; color: #3b82f6; border-color: #bfdbfe; transform: translateY(-1px); }
        .action-btn.active { background: #eff6ff; color: #2563eb; border-color: #3b82f6; box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1); }
        .ai-response-box { margin-top: 16px; padding: 16px; background: #f0fdf4; border-radius: 8px; font-size: 13px; line-height: 1.6; color: #166534; display: none; border: 1px solid #bbf7d0; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05); }
        .ai-response-box.show { display: block; animation: slideDown 0.3s cubic-bezier(0.16, 1, 0.3, 1); }
        .jokbo-expand-btn { text-align: center; padding: 16px; color: #64748b; cursor: pointer; border-top: 1px solid #e2e8f0; margin-top: 10px; font-size: 13px; font-weight: 600; transition: 0.2s; background: white; border-radius: 0 0 12px 12px; }
        .jokbo-expand-btn:hover { background: #f8fafc; color: #3b82f6; }

        .script-segment { background: white; padding: 20px; border-radius: 12px; border: 1px solid #e2e8f0; margin-bottom: 12px; transition: all 0.2s; border-left: 4px solid transparent; }
        .script-segment:hover { border-color: #bfdbfe; background: #f8fafc; }
        .active-context-bg { background-color: #fffbeb !important; border-color: #fcd34d !important; box-shadow: 0 0 0 4px rgba(251, 191, 36, 0.15); border-left-color: #f59e0b !important; }
        .script-header { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 12px; color: #94a3b8; }
        .speaker-name { font-weight: 700; color: #3b82f6; }
        .script-text { font-size: 15px; line-height: 1.65; color: #334155; }

        .chat-input-bar { position: absolute; bottom: 0; left: 0; right: 0; height: 90px; background: white; border-top: 1px solid #e2e8f0; display: none; align-items: center; padding: 0 30px; gap: 16px; z-index: 200; box-shadow: 0 -10px 40px rgba(0,0,0,0.03); }
        .chat-input-bar.visible { display: flex; animation: slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1); }
        @keyframes slideUp { from { transform: translateY(100%); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .chat-input-field { flex: 1; height: 52px; background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 100px; padding: 0 24px; font-size: 15px; color: #334155; outline: none; transition: all 0.2s; }
        .chat-input-field:focus { background: white; border-color: #3b82f6; box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1); }
        .chat-send-btn { width: 52px; height: 52px; background: #3b82f6; border: none; border-radius: 50%; color: white; font-size: 20px; cursor: pointer; display: flex; justify-content: center; align-items: center; transition: all 0.2s; box-shadow: 0 4px 12px rgba(59, 130, 246, 0.25); flex-shrink: 0; }
        .chat-send-btn:hover { background: #2563eb; transform: scale(1.05); }

        .audio-player-bar { position: absolute; bottom: 0; left: 0; right: 0; height: 80px; background: white; border-top: 1px solid #ddd; display: flex; align-items: center; padding: 0 25px; gap: 20px; box-shadow: 0 -4px 20px rgba(0,0,0,0.05); display: none; z-index: 200; }
        .audio-player-bar.visible { display: flex; }
        .play-btn { width: 48px; height: 48px; background: #2196f3; border-radius: 50%; display: flex; justify-content: center; align-items: center; color: white; font-size: 20px; cursor: pointer; box-shadow: 0 4px 10px rgba(33, 150, 243, 0.4); transition: 0.2s; }
        .timeline-box { flex: 1; display: flex; flex-direction: column; gap: 8px; }
        .timeline-bg { height: 6px; background: #eee; border-radius: 3px; position: relative; overflow: hidden; cursor: pointer; }
        .timeline-fill { position: absolute; left: 0; top: 0; height: 100%; width: 0%; background: #2196f3; transition: width 0.2s linear; }
        .time-labels { display: flex; justify-content: space-between; font-size: 12px; color: #888; font-family: monospace; }
    </style>
</head>
<body>

<div id="home-screen">
    <div class="home-card">
        <div class="home-title">Med-Study OS v10</div>
        <div class="home-subtitle">Upload your study materials to get started</div>
        <div class="upload-grid">
            <div class="upload-item" onclick="uploadFile('pdf', this)"><div class="check-mark">âœ“</div><div class="upload-icon">ğŸ“„</div><div class="upload-label">Lecture Notes</div><div class="upload-desc">Drop PDF files here</div></div>
            <div class="upload-item" onclick="uploadFile('jokbo', this)"><div class="check-mark">âœ“</div><div class="upload-icon">ğŸ“‘</div><div class="upload-label">Past Exams (Jokbo)</div><div class="upload-desc">Upload previous test papers</div></div>
            <div class="upload-item" onclick="uploadFile('audio', this)"><div class="check-mark">âœ“</div><div class="upload-icon">ğŸ™ï¸</div><div class="upload-label">Audio / Recording</div><div class="upload-desc">Sync audio with notes</div></div>
        </div>
        <button class="start-btn" id="startBtn" onclick="startStudy()">í•™ìŠµ ì‹œì‘í•˜ê¸°</button>
    </div>
</div>

<div id="main-app">
<div class="tablet-frame">
    <div class="left-panel" id="leftPanel">
        <div class="pdf-header">
            <div style="display: flex; align-items: center; gap: 12px;">
                <span id="headerFileName" style="font-weight: 700; color: #1e293b;">ğŸ“š No File Loaded</span>
                <span id="headerPageNum" style="font-weight: normal; color: #94a3b8; font-size: 13px;">Page 1 / 15</span>
            </div>
            <div class="edit-mode-btn" onclick="toggleDrawingMode()">
                <span style="font-size: 16px;">âœï¸</span><span style="font-size: 13px; font-weight: 600;">í•„ê¸° ëª¨ë“œ</span>
            </div>
        </div>

        <div class="drawing-toolbar" id="drawingToolbar">
            <div class="tool-btn active" onclick="setTool('pen', this)" title="íœ">ğŸ–Šï¸</div>
            <div class="tool-btn" onclick="setTool('highlighter', this)" title="í˜•ê´‘íœ" style="color: #FFD700;">ğŸ–ï¸</div>
            <div class="tool-btn" onclick="setTool('eraser', this)" title="ì§€ìš°ê°œ">ğŸ§½</div>
            <div style="width: 1px; height: 24px; background: #e2e8f0; margin: 0 4px;"></div>
            <div class="tool-btn undo-btn" onclick="undoLastAction()" title="ë˜ëŒë¦¬ê¸°">â†©ï¸</div>
        </div>
        
        <div class="pdf-viewer-container">
            <div class="nav-btn nav-prev disabled" onclick="changePage(-1)">â®</div>
            <div class="nav-btn nav-next" onclick="changePage(1)">â¯</div>
            <div class="trash-drop-zone" id="trashCan">ğŸ—‘ï¸ ì—¬ê¸°ì— ë†“ì•„ ì‚­ì œ</div>

            <!-- Page 1 -->
            <div class="page-wrapper active" id="p1-wrapper">
                <div class="pdf-page" id="p1" ondrop="drop(event)" ondragover="allowDrop(event)">
                    <div style="height:100%; display:flex; flex-direction:column; justify-content:center; align-items:center; text-align:center;">
                        <h1 style="font-size: 42px; color: #1e3a8a; margin-bottom: 20px;">The Chromosomal Basis of Inheritance</h1>
                        <h3 style="color: #64748b; font-weight: 500;">Chapter 12</h3>
                        <div style="width: 80px; height: 6px; background: #2563eb; margin: 40px 0; border-radius: 4px;"></div>
                        <div class="slide-image-container" style="max-width: 600px; margin: 0 auto; background: #f8fafc; padding: 40px;">
                            <span style="font-size: 60px;">ğŸ§¬</span><div class="image-caption" style="margin-top: 20px;">[Image of Chromosome DNA Structure]</div>
                        </div>
                        <p style="color: #94a3b8; margin-top: 40px;">From Mendel to Modern Genetics</p>
                    </div>
                </div>
                <canvas id="canvas-p1" class="drawing-canvas"></canvas>
            </div>

            <!-- Page 2 -->
            <div class="page-wrapper" id="p2-wrapper">
                <div class="pdf-page" id="p2" ondrop="drop(event)" ondragover="allowDrop(event)">
                    <div class="slide-header"><div class="slide-title">Overview: Locating Genes</div><div class="slide-sub">Chromosome Theory</div></div>
                    <div class="content-block"><div class="section-title">History: Sutton and Boveri (1902)</div><p class="text-body">1902ë…„ê²½, ì„¸í¬í•™ìë“¤ì€ ê°ìˆ˜ë¶„ì—´ ì‹œ ì—¼ìƒ‰ì²´ì˜ ê±°ë™ì´ ë©˜ë¸ì˜ "ìœ ì „ ì¸ì" í–‰ë™ê³¼ ì¼ì¹˜í•¨ì„ ë°œê²¬í•˜ê³ , <strong>ì—¼ìƒ‰ì²´ì„¤(Chromosome Theory)</strong>ì„ ì œì°½í–ˆìŠµë‹ˆë‹¤.</p></div>
                    <div class="slide-image-container"><img src="https://placehold.co/700x300/f1f5f9/334155?text=Diagram:+Meiosis+and+Segregation" class="slide-image"><div class="image-caption">[Image 1] Mendel's Laws correlated with Meiosis</div></div>
                    <div class="content-block"><div class="section-title">Core Principles</div><p class="text-body">1. ìœ ì „ìëŠ” ì—¼ìƒ‰ì²´ì˜ íŠ¹ì • ìœ„ì¹˜(Loci)ì— ì¡´ì¬í•œë‹¤.<br>2. ë¶„ë¦¬ì˜ ë²•ì¹™ê³¼ ë…ë¦½ì˜ ë²•ì¹™ì€ ê°ìˆ˜ë¶„ì—´ ê³¼ì •ìœ¼ë¡œ ì„¤ëª…ëœë‹¤.</p></div>
                    <div class="dropped-note" id="note-p2" style="top:400px; left:400px;"><div class="note-header"><strong>AI ë©”ëª¨</strong><span class="note-toggle-btn" onclick="toggleNote(this)">â–¼</span></div><div class="note-body" onclick="focusChat('chat-p2')">ì—¼ìƒ‰ì²´ì„¤ì˜ í•µì‹¬: ë©˜ë¸ì˜ ìœ ì „ìê°€ ì—¼ìƒ‰ì²´ ìœ„ì— ìˆë‹¤ëŠ” ì´ë¡ .</div></div>
                </div>
                <canvas id="canvas-p2" class="drawing-canvas"></canvas>
            </div>

            <!-- Page 3 -->
            <div class="page-wrapper" id="p3-wrapper">
                <div class="pdf-page" id="p3" ondrop="drop(event)" ondragover="allowDrop(event)">
                    <div class="slide-header"><div class="slide-title">Morgan's Experimental Model</div><div class="slide-sub">Drosophila melanogaster</div></div>
                    <div class="content-block"><div class="section-title">Why Fruit Flies?</div><p class="text-body">ëª¨ê±´ì€ ì´ˆíŒŒë¦¬ë¥¼ ëª¨ë¸ë¡œ ì„ íƒí–ˆìŠµë‹ˆë‹¤. 1. ë‹¤ì‚°ì„±(Prolific) 2. ì§§ì€ ì„¸ëŒ€(2ì£¼) 3. ë‹¨ìˆœí•œ ì—¼ìƒ‰ì²´(4ìŒ).</p></div>
                    <div class="slide-image-container"><img src="https://placehold.co/700x350/f1f5f9/334155?text=Image:+Drosophila+Melanogaster" class="slide-image"><div class="image-caption">[Image 2] Common Fruit Fly</div></div>
                    <div class="info-box"><strong>Wild type vs Mutant:</strong> ì•¼ìƒí˜•(ë¶‰ì€ ëˆˆ, $w^+$) vs ëŒì—°ë³€ì´í˜•(í° ëˆˆ, $w$).</div>
                </div>
                <canvas id="canvas-p3" class="drawing-canvas"></canvas>
            </div>

            <!-- Page 4 -->
            <div class="page-wrapper" id="p4-wrapper">
                <div class="pdf-page" id="p4" ondrop="drop(event)" ondragover="allowDrop(event)">
                    <div class="slide-header"><div class="slide-title">Morgan's Experiment</div><div class="slide-sub">Sex-Linkage Discovery</div></div>
                    <div class="content-block"><div class="section-title">The Cross</div><p class="text-body">í° ëˆˆ ìˆ˜ì»· x ë¶‰ì€ ëˆˆ ì•”ì»· êµë°° ê²°ê³¼, F2 ì„¸ëŒ€ì—ì„œ <strong>í° ëˆˆì€ ì˜¤ì§ ìˆ˜ì»·ì—ì„œë§Œ</strong> ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.</p></div>
                    <div class="slide-image-container"><img src="https://placehold.co/700x400/f1f5f9/334155?text=Diagram:+Cross+of+White-Eyed+Male" class="slide-image"><div class="image-caption"> F2 Generation ratio</div></div>
                    <div class="warn-box"><strong>Conclusion:</strong> ëˆˆ ìƒ‰ê¹” ìœ ì „ìëŠ” <strong>X ì—¼ìƒ‰ì²´</strong> ìœ„ì— ì¡´ì¬í•œë‹¤.</div>
                </div>
                <canvas id="canvas-p4" class="drawing-canvas"></canvas>
            </div>

            <!-- Page 5 -->
            <div class="page-wrapper" id="p5-wrapper">
                <div class="pdf-page" id="p5" ondrop="drop(event)" ondragover="allowDrop(event)">
                    <div class="slide-header"><div class="slide-title">Sex Chromosomes</div><div class="slide-sub">X-Y System</div></div>
                    <div class="content-block"><div class="section-title">Mammalian Sex Determination</div><p class="text-body">Female (XX), Male (XY). Y ì—¼ìƒ‰ì²´ëŠ” ë§¤ìš° ì‘ìœ¼ë©° <strong>SRY ìœ ì „ì</strong>ê°€ ìˆì–´ ì •ì†Œ ë°œë‹¬ì„ ìœ ë„í•©ë‹ˆë‹¤.</p></div>
                    <div class="slide-image-container"><img src="https://placehold.co/700x300/f1f5f9/334155?text=Image:+XY+Karyotype" class="slide-image"><div class="image-caption">[Image of Human XY Chromosomes]</div></div>
                </div>
                <canvas id="canvas-p5" class="drawing-canvas"></canvas>
            </div>

            <!-- Page 6 -->
            <div class="page-wrapper" id="p6-wrapper">
                <div class="pdf-page" id="p6" ondrop="drop(event)" ondragover="allowDrop(event)">
                    <div class="slide-header"><div class="slide-title">Sex-Linked Inheritance</div><div class="slide-sub">Transmission</div></div>
                    <div class="content-block"><p class="text-body">ì•„ë²„ì§€ëŠ” ë”¸ì—ê²Œë§Œ Xë¥¼ ì£¼ê³ , ì–´ë¨¸ë‹ˆëŠ” ëª¨ë‘ì—ê²Œ Xë¥¼ ì¤ë‹ˆë‹¤. ë‚¨ì„±ì€ <strong>Hemizygous</strong>í•˜ì—¬ ì—´ì„± í˜•ì§ˆì´ ë°”ë¡œ ë°œí˜„ë©ë‹ˆë‹¤.</p></div>
                    <div class="slide-image-container"><img src="https://placehold.co/700x400/f1f5f9/334155?text=Diagram:+Punnett+Square+Color+Blindness" class="slide-image"><div class="image-caption">[Image of Color Blindness Inheritance]</div></div>
                </div>
                <canvas id="canvas-p6" class="drawing-canvas"></canvas>
            </div>

            <!-- Page 7 -->
            <div class="page-wrapper" id="p7-wrapper">
                <div class="pdf-page" id="p7" ondrop="drop(event)" ondragover="allowDrop(event)">
                    <div class="slide-header"><div class="slide-title">X Inactivation</div><div class="slide-sub">Barr Body</div></div>
                    <div class="content-block"><p class="text-body">ì—¬ì„± ì„¸í¬ì˜ ë‘ X ì¤‘ í•˜ë‚˜ëŠ” ë¬´ì‘ìœ„ë¡œ ì‘ì¶•ë˜ì–´ <strong>ë°”ì†Œì²´(Barr body)</strong>ê°€ ë©ë‹ˆë‹¤. (ì˜ˆ: ì‚¼ìƒ‰ ê³ ì–‘ì´)</p></div>
                    <div class="slide-image-container"><img src="https://placehold.co/700x350/f1f5f9/334155?text=Image:+Calico+Cat" class="slide-image"><div class="image-caption"></div></div>
                </div>
                <canvas id="canvas-p7" class="drawing-canvas"></canvas>
            </div>

            <!-- Page 8 -->
            <div class="page-wrapper" id="p8-wrapper">
                <div class="pdf-page" id="p8" ondrop="drop(event)" ondragover="allowDrop(event)">
                    <div class="slide-header"><div class="slide-title">Linked Genes</div><div class="slide-sub">Linkage</div></div>
                    <div class="content-block"><p class="text-body">ê°™ì€ ì—¼ìƒ‰ì²´ì— ìˆëŠ” ìœ ì „ìëŠ” í•¨ê»˜ ìœ ì „ë˜ëŠ” ê²½í–¥ì´ ìˆìŠµë‹ˆë‹¤. ëª¨ê±´ì€ ëª¸ ìƒ‰ê¹”ê³¼ ë‚ ê°œ í¬ê¸°ê°€ ì—°ê´€ë¨ì„ ë°œê²¬í–ˆìŠµë‹ˆë‹¤.</p></div>
                    <div class="slide-image-container"><img src="https://placehold.co/700x300/f1f5f9/334155?text=Diagram:+Linked+Genes+on+Chromosome" class="slide-image"><div class="image-caption"></div></div>
                </div>
                <canvas id="canvas-p8" class="drawing-canvas"></canvas>
            </div>

            <!-- Page 9 -->
            <div class="page-wrapper" id="p9-wrapper">
                <div class="pdf-page" id="p9" ondrop="drop(event)" ondragover="allowDrop(event)">
                    <div class="slide-header"><div class="slide-title">Genetic Recombination</div><div class="slide-sub">Crossing Over</div></div>
                    <div class="content-block"><p class="text-body">ì—°ê´€ ìœ ì „ìë¼ë„ <strong>êµì°¨(Crossing over)</strong>ë¥¼ í†µí•´ ì¬ì¡°í•©í˜• ìì†ì´ ë‚˜íƒ€ë‚  ìˆ˜ ìˆìŠµë‹ˆë‹¤. (ê°ìˆ˜ 1ë¶„ì—´ ì „ê¸°)</p></div>
                    <div class="slide-image-container"><img src="https://placehold.co/700x400/f1f5f9/334155?text=Diagram:+Crossing+Over+Mechanism" class="slide-image"><div class="image-caption">[Image of Crossing Over during Meiosis I]</div></div>
                </div>
                <canvas id="canvas-p9" class="drawing-canvas"></canvas>
            </div>

            <!-- Page 10 -->
            <div class="page-wrapper" id="p10-wrapper">
                <div class="pdf-page" id="p10" ondrop="drop(event)" ondragover="allowDrop(event)">
                    <div class="slide-header"><div class="slide-title">Genetic Mapping</div><div class="slide-sub">Linkage Map</div></div>
                    <div class="content-block"><p class="text-body">ì¬ì¡°í•© ë¹ˆë„ëŠ” ìœ ì „ì ê°„ ê±°ë¦¬ì— ë¹„ë¡€í•©ë‹ˆë‹¤. <strong>1 Map Unit = 1% Recombination Frequency</strong>.</p></div>
                    <div class="slide-image-container"><img src="https://placehold.co/700x250/f1f5f9/334155?text=Diagram:+Genetic+Map" class="slide-image"><div class="image-caption"></div></div>
                </div>
                <canvas id="canvas-p10" class="drawing-canvas"></canvas>
            </div>

            <!-- Page 11 -->
            <div class="page-wrapper" id="p11-wrapper">
                <div class="pdf-page" id="p11" ondrop="drop(event)" ondragover="allowDrop(event)">
                    <div class="slide-header"><div class="slide-title">Nondisjunction</div><div class="slide-sub">Meiotic Error</div></div>
                    <div class="content-block"><p class="text-body">ê°ìˆ˜ë¶„ì—´ ì¤‘ ì—¼ìƒ‰ì²´ê°€ ì œëŒ€ë¡œ ë¶„ë¦¬ë˜ì§€ ì•ŠëŠ” í˜„ìƒ(ë¹„ë¶„ë¦¬)ì€ ì´ìˆ˜ì„±(Aneuploidy)ì˜ ì›ì¸ì´ ë©ë‹ˆë‹¤.</p></div>
                    <div class="slide-image-container"><img src="https://placehold.co/700x400/f1f5f9/334155?text=Diagram:+Nondisjunction+in+Meiosis+I+and+II" class="slide-image"><div class="image-caption"></div></div>
                </div>
                <canvas id="canvas-p11" class="drawing-canvas"></canvas>
            </div>

            <!-- Page 12 -->
            <div class="page-wrapper" id="p12-wrapper">
                <div class="pdf-page" id="p12" ondrop="drop(event)" ondragover="allowDrop(event)">
                    <div class="slide-header"><div class="slide-title">Aneuploidy Types</div><div class="slide-sub">Monosomy & Trisomy</div></div>
                    <table class="lab-table"><tr><th>Type</th><th>Formula</th><th>Example</th></tr><tr><td>Monosomic</td><td>2n-1</td><td>Turner (XO)</td></tr><tr><td>Trisomic</td><td>2n+1</td><td>Down (21)</td></tr></table>
                    <div class="slide-image-container"><img src="https://placehold.co/700x300/f1f5f9/334155?text=Image:+Karyotype+Examples" class="slide-image"><div class="image-caption"></div></div>
                </div>
                <canvas id="canvas-p12" class="drawing-canvas"></canvas>
            </div>

            <!-- Page 13 -->
            <div class="page-wrapper" id="p13-wrapper">
                <div class="pdf-page" id="p13" ondrop="drop(event)" ondragover="allowDrop(event)">
                    <div class="slide-header"><div class="slide-title">Structural Alterations</div><div class="slide-sub">Chromosome Mutations</div></div>
                    <div class="content-block"><p class="text-body">Deletion (ê²°ì‹¤), Duplication (ì¤‘ë³µ), Inversion (ì—­ìœ„), Translocation (ì „ì¢Œ).</p></div>
                    <div class="slide-image-container"><img src="https://placehold.co/700x400/f1f5f9/334155?text=Diagram:+4+Types+of+Structural+Changes" class="slide-image"><div class="image-caption">[Image of Deletion, Duplication, Inversion, Translocation]</div></div>
                </div>
                <canvas id="canvas-p13" class="drawing-canvas"></canvas>
            </div>

            <!-- Page 14 -->
            <div class="page-wrapper" id="p14-wrapper">
                <div class="pdf-page" id="p14" ondrop="drop(event)" ondragover="allowDrop(event)">
                    <div class="slide-header"><div class="slide-title">Down Syndrome</div><div class="slide-sub">Trisomy 21</div></div>
                    <div class="content-block"><p class="text-body">21ë²ˆ ì—¼ìƒ‰ì²´ê°€ 3ê°œì¸ ì§ˆí™˜. ì‚°ëª¨ì˜ ë‚˜ì´ê°€ ë§ì„ìˆ˜ë¡ ë¹ˆë„ê°€ ì¦ê°€í•©ë‹ˆë‹¤.</p></div>
                    <div class="slide-image-container"><img src="https://placehold.co/700x350/f1f5f9/334155?text=Image:+Trisomy+21+Karyotype" class="slide-image"><div class="image-caption">[Image of Trisomy 21 Karyotype]</div></div>
                </div>
                <canvas id="canvas-p14" class="drawing-canvas"></canvas>
            </div>

            <!-- Page 15 -->
            <div class="page-wrapper" id="p15-wrapper">
                <div class="pdf-page" id="p15" ondrop="drop(event)" ondragover="allowDrop(event)">
                    <div class="slide-header"><div class="slide-title">Summary</div><div class="slide-sub">Chapter 12 Review</div></div>
                    <div class="content-block">
                        <ul style="line-height:2;">
                            <li>Genes are on chromosomes (Chromosome Theory).</li>
                            <li>Sex-linked genes exhibit unique inheritance patterns.</li>
                            <li>Linked genes tend to be inherited together but can cross over.</li>
                            <li>Errors in meiosis cause chromosomal disorders.</li>
                        </ul>
                    </div>
                    <div class="slide-image-container"><img src="https://placehold.co/700x250/f1f5f9/334155?text=Image:+Concept+Map" class="slide-image"><div class="image-caption"></div></div>
                </div>
                <canvas id="canvas-p15" class="drawing-canvas"></canvas>
            </div>

        </div>
    </div>

    <!-- Right Panel -->
    <div class="right-panel">
        <div class="tabs">
            <div class="tab active" onclick="showTab('tab-chat')">AI ì±„íŒ…</div>
            <div class="tab" onclick="showTab('tab-jokbo')">ê´€ë ¨ ì¡±ë³´</div>
            <div class="tab" onclick="showTab('tab-script')">ë…¹ìŒ ìŠ¤í¬ë¦½íŠ¸</div>
        </div>

        <div class="tab-content-container">
            <div id="tab-chat" class="tab-content active">
                <div class="chat-container" id="chatContainer">
                    <div class="msg-group" id="chat-p3" onclick="goToPage('3')">
                        <div class="msg-meta"><span>Page 3</span><span>â€¢</span><span>Morgan's Choice</span></div>
                        <div class="bubble user-msg">ì™œ í•˜í•„ ì´ˆíŒŒë¦¬ë¥¼ ì“´ ê±°ì•¼?</div>
                        <div class="bubble ai-msg">
                            <div class="chat-drag-handle" draggable="true" ondragstart="dragWholeBubble(event)">::: (Drag)</div>
                            <strong>ì´ˆíŒŒë¦¬(<em>Drosophila melanogaster</em>)ë¥¼ ì„ íƒí•œ ì´ìœ :</strong><br><br>
                            1. <strong>ë†’ì€ ë²ˆì‹ë ¥(High Fecundity):</strong> í•œ ë²ˆì˜ êµë°°ë¡œ ìˆ˜ë°± ë§ˆë¦¬ì˜ ìì†ì„ ë‚³ì•„ í†µê³„ì ìœ¼ë¡œ ìœ ì˜ë¯¸í•œ ìœ ì „í•™ì  ë°ì´í„°ë¥¼ ì–»ê¸°ì— ë§¤ìš° ìœ ë¦¬í•©ë‹ˆë‹¤.<br>
                            2. <strong>ì§§ì€ ì„¸ëŒ€ ê¸°ê°„(Short Generation Time):</strong> ì•½ 2ì£¼ë©´ ì•Œì—ì„œ ì„±ì²´ë¡œ ìë¼ ìƒˆë¡œìš´ ì„¸ëŒ€ë¥¼ í˜•ì„±í•˜ë¯€ë¡œ, ì§§ì€ ì‹œê°„ ì•ˆì— ì—¬ëŸ¬ ì„¸ëŒ€ì— ê±¸ì¹œ ìœ ì „ í˜„ìƒì„ ê´€ì°°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
                            3. <strong>ë‹¨ìˆœí•œ ìœ ì „ì²´(Simple Genome):</strong> ë‹¨ 4ìŒì˜ ì—¼ìƒ‰ì²´(3ìŒì˜ ìƒì—¼ìƒ‰ì²´ì™€ 1ìŒì˜ ì„±ì—¼ìƒ‰ì²´)ë§Œì„ ê°€ì§€ê³  ìˆì–´ ìœ ì „ì ì§€ë„ ì‘ì„±ê³¼ ëŒì—°ë³€ì´ ì¶”ì ì— ìš©ì´í•©ë‹ˆë‹¤.<br>
                            4. <strong>ê²½ì œì„±:</strong> ì‘ì€ ë³‘ì—ì„œ ì‰½ê²Œ í‚¤ìš¸ ìˆ˜ ìˆì–´ ìœ ì§€ ë¹„ìš©ì´ ë§¤ìš° ì €ë ´í•©ë‹ˆë‹¤.
                        </div>
                    </div>
                    <div class="msg-group" id="chat-p5" onclick="goToPage('5')">
                        <div class="msg-meta"><span>Page 5</span><span>â€¢</span><span>Sex Determination</span></div>
                        <div class="bubble user-msg">SRY ìœ ì „ìê°€ ì •í™•íˆ ë­ì•¼?</div>
                        <div class="bubble ai-msg">
                            <div class="chat-drag-handle" draggable="true" ondragstart="dragWholeBubble(event)">::: (Drag)</div>
                            <strong>SRY (Sex-determining Region Y) ìœ ì „ìë€?</strong><br><br>
                            Y ì—¼ìƒ‰ì²´ì— ìœ„ì¹˜í•œ í•µì‹¬ì ì¸ ì„± ê²°ì • ìœ ì „ìì…ë‹ˆë‹¤. ì´ ìœ ì „ìëŠ” ë¯¸ë¶„í™”ëœ ìƒì‹ì„ ì„ <strong>ì •ì†Œ(Testes)</strong>ë¡œ ë°œë‹¬ì‹œí‚¤ëŠ” 'ë§ˆìŠ¤í„° ìŠ¤ìœ„ì¹˜' ì—­í• ì„ í•©ë‹ˆë‹¤.<br><br>
                            - <strong>ì‘ìš© ê¸°ì „:</strong> SRY ìœ ì „ìê°€ ë°œí˜„ë˜ë©´ ê³ í™˜ ê²°ì • ì¸ì(TDF)ë¼ëŠ” ë‹¨ë°±ì§ˆì´ ìƒì„±ë˜ì–´, ë‚¨ì„± ìƒì‹ê¸°ê´€ ë°œë‹¬ì„ ìœ ë„í•˜ëŠ” ë‹¤ë¥¸ ìœ ì „ìë“¤ì„ í™œì„±í™”í•©ë‹ˆë‹¤.<br>
                            - <strong>ê²°ê³¼:</strong> SRYê°€ ìˆìœ¼ë©´ ë‚¨ì„±ì´ ë˜ê³ , ì—†ìœ¼ë©´(XX ë˜ëŠ” XYë¼ë„ SRY ê²°ì‹¤ ì‹œ) ë‚œì†Œ ë°œë‹¬ ê²½ë¡œë¥¼ ë”°ë¼ ì—¬ì„±ì´ ë©ë‹ˆë‹¤.
                        </div>
                    </div>
                    <div class="msg-group" id="chat-p9" onclick="goToPage('9')">
                        <div class="msg-meta"><span>Page 9</span><span>â€¢</span><span>Recombination</span></div>
                        <div class="bubble user-msg">êµì°¨(Crossing over)ëŠ” ì–¸ì œ ì¼ì–´ë‚˜?</div>
                        <div class="bubble ai-msg">
                            <div class="chat-drag-handle" draggable="true" ondragstart="dragWholeBubble(event)">::: (Drag)</div>
                            <strong>êµì°¨(Crossing over)ì˜ ì‹œê¸°ì™€ ê¸°ì „:</strong><br><br>
                            - <strong>ì‹œê¸°:</strong> <strong>ê°ìˆ˜ 1ë¶„ì—´ ì „ê¸°(Prophase I)</strong>ì— ì¼ì–´ë‚©ë‹ˆë‹¤.<br>
                            - <strong>ê³¼ì •:</strong> ìƒë™ ì—¼ìƒ‰ì²´ë¼ë¦¬ ì§ì„ ì§€ì–´ ë¶™ì–´ìˆëŠ” <strong>ì ‘í•©(Synapsis)</strong> ìƒíƒœì—ì„œ, ë¹„ìë§¤ ì—¼ìƒ‰ë¶„ì²´(Non-sister chromatids)ë¼ë¦¬ DNA ì¡°ê°ì„ êµí™˜í•©ë‹ˆë‹¤. ì´ë•Œ êµì°¨ê°€ ì¼ì–´ë‚œ ì§€ì ì„ **í‚¤ì•„ìŠ¤ë§ˆ(Chiasmata)**ë¼ê³  í•©ë‹ˆë‹¤.<br>
                            - <strong>ì˜ì˜:</strong> ë¶€ëª¨ ì„¸ëŒ€ì—ëŠ” ì—†ë˜ ìƒˆë¡œìš´ ìœ ì „ì ì¡°í•©ì„ ê°€ì§„ <strong>ì¬ì¡°í•© ì—¼ìƒ‰ì²´(Recombinant chromosomes)</strong>ë¥¼ ë§Œë“¤ì–´ë‚´ì–´, ìì†ì˜ ìœ ì „ì  ë‹¤ì–‘ì„±ì„ í¬ê²Œ ì¦ê°€ì‹œí‚µë‹ˆë‹¤.
                        </div>
                    </div>
                    <div class="msg-group" id="chat-p10" onclick="goToPage('10')">
                        <div class="msg-meta"><span>Page 10</span><span>â€¢</span><span>Genetic Mapping</span></div>
                        <div class="bubble user-msg">Map Unit ê³„ì‚°ì€ ì–´ë–»ê²Œ í•´?</div>
                        <div class="bubble ai-msg">
                            <div class="chat-drag-handle" draggable="true" ondragstart="dragWholeBubble(event)">::: (Drag)</div>
                            <strong>ìœ ì „ì ì§€ë„ ê±°ë¦¬(Map Unit) ê³„ì‚°ë²•:</strong><br><br>
                            1 Map Unit(ë˜ëŠ” 1 Centimorgan, cM)ì€ <strong>1%ì˜ ì¬ì¡°í•© ë¹ˆë„(Recombination Frequency)</strong>ë¡œ ì •ì˜ë©ë‹ˆë‹¤.<br><br>
                            <strong>ê³µì‹:</strong><br>
                            $$ \text{Map Unit} = \frac{\text{ì¬ì¡°í•©ëœ ìì† ìˆ˜}}{\text{ì´ ìì† ìˆ˜}} \times 100(\%) $$<br><br>
                            <strong>ì˜ˆì‹œ:</strong><br>
                            ì´ ìì† 1000ë§ˆë¦¬ ì¤‘ ë¶€ëª¨ì™€ ë‹¤ë¥¸ í˜•ì§ˆ ì¡°í•©(ì¬ì¡°í•©í˜•)ì„ ê°€ì§„ ìì†ì´ 170ë§ˆë¦¬ë¼ë©´?<br>
                            $$ \frac{170}{1000} \times 100 = 17\% $$<br>
                            ë”°ë¼ì„œ ë‘ ìœ ì „ì ì‚¬ì´ì˜ ê±°ë¦¬ëŠ” <strong>17 Map Units (17 cM)</strong>ì…ë‹ˆë‹¤.
                        </div>
                    </div>
                </div>
            </div>
            <div id="tab-jokbo" class="tab-content">
                <div id="jokbo-list">
                    <div class="jokbo-card p4-item visible" onclick="goToPage('4')">
                        <div class="badge-row"><span class="badge year">ê¸°ì¶œ</span><span class="badge freq">â˜…ì¤‘ìš”</span></div>
                        <div class="q-body">Q. ëª¨ê±´ì˜ ì‹¤í—˜ì—ì„œ F2 ì„¸ëŒ€ì˜ í° ëˆˆ(White-eyed) ê°œì²´ëŠ” ì–´ë–¤ íŠ¹ì§•ì„ ë³´ì˜€ëŠ”ê°€?</div>
                        <div class="q-options"><div>â‘¢ <strong>ìˆ˜ì»·ì—ì„œë§Œ ë‚˜íƒ€ë‚¬ë‹¤.</strong></div></div>
                        <div class="jokbo-actions" onclick="event.stopPropagation()">
                            <div class="action-btn" onclick="handleJokboAction('answer', this)">ğŸ“ ì •ë‹µ ë° í•´ì„¤</div>
                            <div class="action-btn" onclick="handleJokboAction('point', this)">ğŸ¯ ì¶œì œí¬ì¸íŠ¸</div>
                            <div class="action-btn" onclick="handleJokboAction('twin', this)">ğŸ”„ ìŒë‘¥ì´ë¬¸ì œ</div>
                        </div>
                        <div class="ai-response-box"></div>
                    </div>
                    <div class="jokbo-card p6-item" onclick="goToPage('6')"><div class="q-body">Q. ì ë¡ ìƒ‰ë§¹ì´ ë‚¨ì„±ì—ê²Œ í”í•œ ì´ìœ ?</div><div class="q-options"><div>â‘¡ Hemizygousí•˜ê¸° ë•Œë¬¸</div></div><div class="jokbo-actions" onclick="event.stopPropagation()"><div class="action-btn" onclick="handleJokboAction('answer', this)">ğŸ“ í•´ì„¤</div><div class="action-btn" onclick="handleJokboAction('point', this)">ğŸ¯ í¬ì¸íŠ¸</div></div><div class="ai-response-box"></div></div>
                </div>
                <div class="jokbo-expand-btn" id="jokboExpandBtn" onclick="toggleJokboExpand()"><span>â–¼</span> ì „ì²´ ë¬¸ì œ ë³´ê¸°</div>
            </div>
            <div id="tab-script" class="tab-content">
                <div class="script-segment" id="script-p2"><div class="script-header"><span class="speaker-name">êµìˆ˜ë‹˜</span></div><div class="script-text">ì˜¤ëŠ˜ì€ 12ë‹¨ì›ì…ë‹ˆë‹¤. ì—¼ìƒ‰ì²´ì„¤ì˜ ì‹œì‘ì— ëŒ€í•´ ì•Œì•„ë´…ì‹œë‹¤.</div></div>
            </div>
        </div>
        <div class="chat-input-bar visible" id="chatInputBar"><input type="text" class="chat-input-field" id="userQueryInput" placeholder="AIì—ê²Œ ì§ˆë¬¸í•˜ê¸°..."><button class="chat-send-btn" id="sendBtn">â–¶</button></div>
        <div class="audio-player-bar" id="audioPlayer"><div class="play-btn">â–¶</div><div class="timeline-box"><div class="timeline-bg"><div class="timeline-fill" id="audioProgress"></div></div><div class="time-labels"><span>00:00</span><span>20:00</span></div></div></div>
    </div>
</div>
</div>

<script>
    // (Script Logic Unchanged except for ensuring goToPage is robust)
    const pages = Array.from({length: 15}, (_, i) => `p${i+1}`);
    let currentPageIdx = 0;
    const apiKey = "";
    let isDrawingMode = false, currentTool = 'pen', isPainting = false, currentCanvas, ctx, lastX = 0, lastY = 0;
    const canvasHistory = {}; const maxHistoryStep = 20; let isJokboExpanded = false;

    window.onload = function() { initCanvases(); initGeminiChat(); syncRightPanel('1'); const n=document.getElementById('note-p2'); if(n) initNoteEvents(n); };

    function uploadFile(t,e){ if(e.classList.contains('completed'))return; e.style.opacity='0.7'; setTimeout(()=>{e.classList.add('completed'); e.style.opacity='1'; if(document.querySelectorAll('.upload-item.completed').length>0)document.getElementById('startBtn').classList.add('active');},800); }
    function startStudy(){ document.getElementById('home-screen').classList.add('hidden'); setTimeout(()=>{document.getElementById('home-screen').style.display='none'; document.getElementById('main-app').classList.add('visible'); initCanvases(); document.getElementById('headerFileName').innerText='ğŸ“š Campbell Biology_Ch12.pdf';},500); }
    
    function goToPage(n){ const t=parseInt(n)-1; if(t<0||t>=pages.length)return; document.getElementById(`${pages[currentPageIdx]}-wrapper`).classList.remove('active'); currentPageIdx=t; document.getElementById(`${pages[currentPageIdx]}-wrapper`).classList.add('active'); document.getElementById('headerPageNum').innerText=`Page ${n} / 15`; updateCurrentCanvas(); syncRightPanel(n); 
        const prevBtn = document.querySelector('.nav-prev');
        const nextBtn = document.querySelector('.nav-next');
        if (prevBtn) prevBtn.classList.toggle('disabled', currentPageIdx === 0);
        if (nextBtn) nextBtn.classList.toggle('disabled', currentPageIdx === pages.length - 1);
    }
    function changePage(d){ const n=currentPageIdx+d; if(n<0||n>=pages.length)return; document.getElementById(`${pages[currentPageIdx]}-wrapper`).classList.remove('active'); currentPageIdx=n; document.getElementById(`${pages[currentPageIdx]}-wrapper`).classList.add('active'); const p=pages[currentPageIdx].replace('p',''); document.getElementById('headerPageNum').innerText=`Page ${p} / 15`; updateCurrentCanvas(); syncRightPanel(p); 
        const prevBtn = document.querySelector('.nav-prev');
        const nextBtn = document.querySelector('.nav-next');
        if (prevBtn) prevBtn.classList.toggle('disabled', currentPageIdx === 0);
        if (nextBtn) nextBtn.classList.toggle('disabled', currentPageIdx === pages.length - 1);
    }

    function toggleDrawingMode(){ isDrawingMode=!isDrawingMode; const p=document.getElementById('leftPanel'); const t=document.getElementById('drawingToolbar'); const b=document.querySelector('.edit-mode-btn'); if(isDrawingMode){p.classList.add('drawing-mode');t.classList.add('visible');b.classList.add('active');b.querySelector('span:last-child').innerText='í•„ê¸° ì¢…ë£Œ';}else{p.classList.remove('drawing-mode');t.classList.remove('visible');b.classList.remove('active');b.querySelector('span:last-child').innerText='í•„ê¸° ëª¨ë“œ';} }
    function setTool(t,e){ currentTool=t; document.querySelectorAll('.tool-btn').forEach(el=>el.classList.remove('active')); e.classList.add('active'); }
    function updateCurrentCanvas(){ currentCanvas=document.getElementById(`canvas-${pages[currentPageIdx]}`); ctx=currentCanvas.getContext('2d',{willReadFrequently:true}); }
    function startDrawing(e){ if(!isDrawingMode)return; isPainting=true; [lastX,lastY]=getCoords(e); saveHist(); draw(e); }
    function draw(e){ if(!isPainting||!isDrawingMode)return; const [x,y]=getCoords(e); ctx.beginPath(); ctx.moveTo(lastX,lastY); ctx.lineTo(x,y); if(currentTool==='pen'){ctx.strokeStyle='#222';ctx.lineWidth=2;ctx.globalCompositeOperation='source-over';}else if(currentTool==='highlighter'){ctx.strokeStyle='rgba(255,235,59,0.4)';ctx.lineWidth=20;ctx.globalCompositeOperation='source-over';}else{ctx.lineWidth=30;ctx.globalCompositeOperation='destination-out';} ctx.stroke(); [lastX,lastY]=[x,y]; }
    function stopDrawing(){ if(isPainting){isPainting=false;ctx.beginPath();} }
    function getCoords(e){ const r=currentCanvas.getBoundingClientRect(); const x=e.clientX||e.touches[0].clientX; const y=e.clientY||e.touches[0].clientY; return [x-r.left,y-r.top]; }
    function saveHist(){ const id=pages[currentPageIdx]; if(!canvasHistory[id])canvasHistory[id]=[]; canvasHistory[id].push(ctx.getImageData(0,0,currentCanvas.width,currentCanvas.height)); if(canvasHistory[id].length>maxHistoryStep)canvasHistory[id].shift(); }
    function undoLastAction(){ const id=pages[currentPageIdx]; if(canvasHistory[id]&&canvasHistory[id].length>0)ctx.putImageData(canvasHistory[id].pop(),0,0); else ctx.clearRect(0,0,currentCanvas.width,currentCanvas.height); }
    
    function initCanvases(){ document.querySelectorAll('.page-wrapper').forEach(w=>{ const id=w.id.replace('-wrapper',''); const c=document.getElementById(`canvas-${id}`); const p=document.getElementById(id); c.width=p.offsetWidth; c.height=p.offsetHeight; c.addEventListener('mousedown',startDrawing); c.addEventListener('mousemove',draw); c.addEventListener('mouseup',stopDrawing); c.addEventListener('mouseout',stopDrawing); c.addEventListener('touchstart',e=>{e.preventDefault();startDrawing(e)},{passive:false}); c.addEventListener('touchmove',e=>{e.preventDefault();draw(e)},{passive:false}); c.addEventListener('touchend',stopDrawing); canvasHistory[id]=[]; }); updateCurrentCanvas(); }

    function syncRightPanel(p){ if(isJokboExpanded) toggleJokboExpand(); document.querySelectorAll('.jokbo-card').forEach(c=>c.classList.remove('visible'));
        if(['4','5'].includes(p)) document.querySelector('.p4-item')?.classList.add('visible');
        if(['6','7'].includes(p)) document.querySelector('.p6-item')?.classList.add('visible');
        const map={'2':'script-p2','3':'chat-p3','5':'chat-p5','9':'chat-p9','10':'chat-p10'};
        const t=map[p]; if(t){ const el=document.getElementById(t); if(el) el.scrollIntoView({behavior:'smooth',block:'center'}); highlight(el); }
    }
    function highlight(el){ if(!el)return; document.querySelectorAll('.active-context-bg').forEach(e=>e.classList.remove('active-context-bg')); el.classList.add('active-context-bg'); setTimeout(()=>el.classList.remove('active-context-bg'),2000); }
    function showTab(id){ document.querySelectorAll('.tab,.tab-content').forEach(e=>e.classList.remove('active')); document.getElementById(id).classList.add('active'); const idx=['tab-chat','tab-jokbo','tab-script'].indexOf(id); document.querySelectorAll('.tab')[idx].classList.add('active'); const p=document.getElementById('audioPlayer'); const c=document.getElementById('chatInputBar'); if(id==='tab-script')p.classList.add('visible');else p.classList.remove('visible'); if(id==='tab-chat')c.classList.add('visible');else c.classList.remove('visible'); }
    
    function focusChat(id){ showTab('tab-chat'); const el=document.getElementById(id); if(el){el.scrollIntoView({behavior:'smooth',block:'center'}); highlight(el);} }
    function toggleNote(btn){ const n=btn.closest('.dropped-note'); n.classList.toggle('collapsed'); btn.innerText=n.classList.contains('collapsed')?'â–²':'â–¼'; }
    function dragWholeBubble(e){ if(isDrawingMode){e.preventDefault();return;} const b=e.target.closest('.ai-msg'); const c=b.cloneNode(true); c.querySelector('.chat-drag-handle')?.remove(); e.dataTransfer.setData("chatId",b.parentElement.id); e.dataTransfer.setData("text",c.innerText); }
    function allowDrop(e){e.preventDefault();}
    function drop(e){ e.preventDefault(); if(isDrawingMode)return; let txt=e.dataTransfer.getData("text")||e.dataTransfer.getData("text/plain"); if(!txt)return; const rect=e.currentTarget.getBoundingClientRect(); const n=document.createElement('div'); n.className='dropped-note'; n.innerHTML=`<div class="note-header"><strong>AI ë©”ëª¨</strong><span class="note-toggle-btn" onclick="toggleNote(this)">â–¼</span></div><div class="note-body" onclick="focusChat('${e.dataTransfer.getData("chatId")}')">${txt}</div>`; n.style.left=(e.clientX-rect.left-20)+'px'; n.style.top=(e.clientY-rect.top-20)+'px'; initNoteEvents(n); e.currentTarget.appendChild(n); }
    
    let dNote=null, dX=0, dY=0;
    function initNoteEvents(n){ const h=n.querySelector('.note-header'); if(h){ h.addEventListener('mousedown',e=>{dNote=n; const r=n.getBoundingClientRect(); dX=e.clientX-r.left; dY=e.clientY-r.top; document.getElementById('trashCan').classList.add('active'); document.addEventListener('mousemove',moveNote); document.addEventListener('mouseup',dropNote); }); } }
    function moveNote(e){ if(!dNote)return; const p=dNote.parentElement.getBoundingClientRect(); dNote.style.left=(e.clientX-p.left-dX)+'px'; dNote.style.top=(e.clientY-p.top-dY)+'px'; const t=document.getElementById('trashCan'); if(isColliding(dNote.getBoundingClientRect(),t.getBoundingClientRect())) t.classList.add('hover'); else t.classList.remove('hover'); }
    function dropNote(){ if(dNote){ const t=document.getElementById('trashCan'); if(t.classList.contains('hover')) dNote.remove(); t.classList.remove('active','hover'); dNote=null; document.removeEventListener('mousemove',moveNote); document.removeEventListener('mouseup',dropNote); } }
    function isColliding(r1,r2){ return !(r1.right<r2.left||r1.left>r2.right||r1.bottom<r2.top||r1.top>r2.bottom); }

    async function handleJokboAction(type, btn) {
        const card=btn.closest('.jokbo-card'); const box=card.querySelector('.ai-response-box');
        if(btn.classList.contains('active')){ box.classList.remove('show'); btn.classList.remove('active'); setTimeout(()=>{box.style.display='none'},200); return; }
        card.querySelectorAll('.action-btn').forEach(b=>b.classList.remove('active')); btn.classList.add('active');
        box.style.display='block'; box.innerHTML='Analyzing...'; box.classList.add('show');
        await new Promise(r=>setTimeout(r,600));
        let res=""; const q=card.querySelector('.q-body').innerText;
        if(q.includes('ëª¨ê±´')) {
            if(type==='answer') res=`**ì •ë‹µ: â‘¢ ìˆ˜ì»·ì—ì„œë§Œ ë‚˜íƒ€ë‚¬ë‹¤.**\n\n**ìƒì„¸ í•´ì„¤:**\nëª¨ê±´ì˜ ì‹¤í—˜ì—ì„œ í° ëˆˆ ìœ ì „ìëŠ” **X ì—¼ìƒ‰ì²´**ì— ìœ„ì¹˜í•œ ì—´ì„± ìœ ì „ìì…ë‹ˆë‹¤. F1 ì„¸ëŒ€(ë¶‰ì€ ëˆˆ ì•”ìˆ˜)ë¥¼ êµë°°í–ˆì„ ë•Œ, ìˆ˜ì»·ì€ ì–´ë¨¸ë‹ˆë¡œë¶€í„° ì—´ì„± ìœ ì „ìë¥¼ ë¬¼ë ¤ë°›ìœ¼ë©´ Y ì—¼ìƒ‰ì²´ì—ëŠ” ëŒ€ì‘í•˜ëŠ” ìœ ì „ìê°€ ì—†ì–´ ë°”ë¡œ í° ëˆˆì´ ë°œí˜„ë©ë‹ˆë‹¤.`;
            else if(type==='point') res=`**ğŸ¯ ì¶œì œ í¬ì¸íŠ¸:**\n1. **ë°˜ì„± ìœ ì „(Sex-linked Inheritance)**ì˜ ê°œë… ì´í•´\n2. ë©˜ë¸ ë²•ì¹™ì˜ ì˜ˆì™¸ ìƒí™©ì¸ **ì„± ì—°ê´€ ìœ ì „** íŒŒì•…`;
            else if(type==='twin') res=`**ğŸ”„ ìŒë‘¥ì´ ë¬¸ì œ:**\ní˜ˆìš°ë³‘ ë³´ì¸ìì¸ ì–´ë¨¸ë‹ˆì™€ ì •ìƒì¸ ì•„ë²„ì§€ ì‚¬ì´ì—ì„œ íƒœì–´ë‚œ **ì•„ë“¤**ì´ í˜ˆìš°ë³‘ì¼ í™•ë¥ ì€?\n**ì •ë‹µ:** 50%`;
        } else if(q.includes('ìƒ‰ë§¹')) {
            if(type==='answer') res=`**ì •ë‹µ: â‘¡ Hemizygousí•˜ê¸° ë•Œë¬¸**\n\n**í•´ì„¤:** ë‚¨ì„±ì€ XYë¡œ X ì—¼ìƒ‰ì²´ê°€ í•˜ë‚˜ë¿ì…ë‹ˆë‹¤. ì´ë¥¼ **ë°˜ì ‘í•©ì„±(Hemizygous)** ìƒíƒœë¼ê³  í•©ë‹ˆë‹¤. ì—¬ì„±ì€ ë³´ì¸ìê°€ ë  ìˆ˜ ìˆì§€ë§Œ, ë‚¨ì„±ì€ ìœ ì „ìê°€ í•˜ë‚˜ë¿ì´ë¼ ì—´ì„± í˜•ì§ˆì´ ë°”ë¡œ ë“œëŸ¬ë‚©ë‹ˆë‹¤.`;
            else if(type==='point') res=`**ğŸ¯ ì¶œì œ í¬ì¸íŠ¸:**\n'Hemizygous' ìš©ì–´ì˜ ì •ì˜ì™€ ë‚¨ì„±ì˜ ë°˜ì„± ìœ ì „ ë°œí˜„ ë¹ˆë„ê°€ ë†’ì€ ì´ìœ ë¥¼ ë¬»ëŠ” ë¬¸ì œì…ë‹ˆë‹¤.`;
        } else { res="**[AI]** ë¶„ì„ ê²°ê³¼ì…ë‹ˆë‹¤."; }
        box.innerHTML=res.replace(/\*\*(.*?)\*\*/g,'<strong>$1</strong>').replace(/\n/g,'<br>');
    }
    function toggleJokboExpand(){ isJokboExpanded=!isJokboExpanded; const t=document.getElementById('tab-jokbo'); const b=document.getElementById('jokboExpandBtn'); if(isJokboExpanded){t.classList.add('expanded');b.innerText='ì ‘ê¸°';}else{t.classList.remove('expanded');b.innerText='ì „ì²´ ë³´ê¸°';} }
    
    function initGeminiChat(){
        document.getElementById('sendBtn').onclick=async()=>{
            const i=document.getElementById('userQueryInput'); const t=i.value.trim(); if(!t)return;
            appendMsg(t,'user'); i.value=''; appendMsg('Thinking...','ai',true);
            setTimeout(()=>{ document.querySelector('.ai-loading')?.parentElement.remove(); appendMsg(`[AI ë‹µë³€] "${t}"ì— ëŒ€í•œ ì„¤ëª…ì…ë‹ˆë‹¤. ê´€ë ¨ ë‚´ìš©ì€ ${currentPageIdx+1}í˜ì´ì§€ë¥¼ ì°¸ê³ í•˜ì„¸ìš”.`,'ai'); },1000);
        }
    }
    function appendMsg(t,s,l=false){
        const c=document.getElementById('chatContainer'); const d=document.createElement('div'); d.className='msg-group'; 
        d.innerHTML=`<div class="bubble ${s}-msg ${l?'ai-loading':''}">${s==='ai'&&!l?`<div class="chat-drag-handle" draggable="true" ondragstart="dragWholeBubble(event)">::: (Drag)</div>`:''}${t}</div>`;
        c.appendChild(d); c.scrollTop=c.scrollHeight;
    }
</script>
</body>
</html>
